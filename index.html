<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Putzplan App - DEBUG MODE</title>
    <!-- Font Awesome for better icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Responsive App Container */
        .app-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: #ffffff;
            position: relative;
            overflow-x: hidden;
        }

        /* Desktop/Tablet - App-Ã¤hnliche Darstellung mit Schatten */
        @media (min-width: 769px) {
            .app-container {
                max-width: 700px;
                margin: 20px auto;
                min-height: calc(100vh - 40px);
                border-radius: 24px;
                box-shadow: 0 0 60px rgba(0, 0, 0, 0.15);
                overflow: hidden;
            }
        }

        /* Tablet Portrait */
        @media (min-width: 481px) and (max-width: 768px) {
            .app-container {
                max-width: 580px;
                margin: 10px auto;
                min-height: calc(100vh - 20px);
                border-radius: 16px;
                box-shadow: 0 0 40px rgba(0, 0, 0, 0.1);
            }
        }

        /* Mobile - Vollbild */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }
            
            body {
                padding: 0;
            }
        }
        /* Status Bar - iOS Style */
        .debug-banner {
            background: linear-gradient(135deg, #ff416c 0%, #ff4757 100%);
            color: white;
            text-align: center;
            padding: 12px 20px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            font-size: 13px;
            letter-spacing: 0.3px;
            box-shadow: 0 2px 10px rgba(255, 65, 108, 0.3);
        }

        /* Responsive Container Padding */
        .container { 
            padding: 60px 16px 20px;
            max-width: 100%;
        }

        /* Desktop */
        @media (min-width: 769px) {
            .container {
                padding: 70px 32px 32px;
            }
        }

        /* Tablet */
        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                padding: 65px 20px 20px;
            }
        }

        /* Mobile */
        @media (max-width: 480px) {
            .container {
                padding: 55px 16px 16px;
            }
        }
        /* Responsive App Cards */
        .card { 
            background: #ffffff; 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            margin: 12px 0;
            border: 0.5px solid rgba(0, 0, 0, 0.04);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        /* Desktop - GrÃ¶ÃŸere Cards */
        @media (min-width: 769px) {
            .card {
                border-radius: 20px;
                padding: 28px;
                margin: 20px 0;
            }
        }

        /* Tablet */
        @media (min-width: 481px) and (max-width: 768px) {
            .card {
                border-radius: 18px;
                padding: 24px;
                margin: 16px 0;
            }
        }

        /* Mobile - Kompaktere Cards */
        @media (max-width: 480px) {
            .card {
                border-radius: 14px;
                padding: 18px;
                margin: 10px 0;
            }
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
        }

        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
        }
        /* Responsive Avatar Grid */
        .avatar-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            margin: 16px 0;
        }

        /* Desktop - Mehr Platz */
        @media (min-width: 769px) {
            .avatar-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 16px;
                margin: 24px 0;
            }
        }

        /* Tablet */
        @media (min-width: 481px) and (max-width: 768px) {
            .avatar-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 14px;
                margin: 20px 0;
            }
        }

        /* Mobile - Kompakter */
        @media (max-width: 480px) {
            .avatar-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                margin: 14px 0;
            }
        }
        /* Modern Avatar Selection */
        .avatar-option { 
            aspect-ratio: 1;
            border: 3px solid rgba(0, 0, 0, 0.08);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        .avatar-option:hover { 
            border-color: #667eea; 
            transform: scale(1.05) translateY(-2px); 
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
        }
        .avatar-option.selected { 
            border-color: #667eea; 
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
        }
        /* Responsive Form Groups */
        .form-group { margin: 20px 0; }
        .form-group label { 
            display: block; 
            margin-bottom: 10px; 
            font-weight: 600; 
            color: #1f2937;
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        /* Desktop - Mehr Abstand */
        @media (min-width: 769px) {
            .form-group { margin: 28px 0; }
            .form-group label { 
                margin-bottom: 14px;
                font-size: 15px;
            }
        }

        /* Tablet */
        @media (min-width: 481px) and (max-width: 768px) {
            .form-group { margin: 24px 0; }
            .form-group label { 
                margin-bottom: 12px;
                font-size: 14px;
            }
        }

        /* Mobile - Kompakter */
        @media (max-width: 480px) {
            .form-group { margin: 18px 0; }
            .form-group label { 
                margin-bottom: 8px;
                font-size: 14px;
            }
        }
        .form-group input { 
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 14px;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            font-family: inherit;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* Desktop - GrÃ¶ÃŸere Inputs */
        @media (min-width: 769px) {
            .form-group input {
                padding: 16px 20px;
                border-radius: 16px;
                font-size: 16px;
            }
        }

        /* Mobile - Touch-friendly Inputs */
        @media (max-width: 480px) {
            .form-group input {
                padding: 14px 16px;
                border-radius: 12px;
                font-size: 16px; /* iOS zoom prevention */
            }
        }
        .form-group input:focus { 
            outline: none; 
            border-color: #667eea; 
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        .form-group select { 
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 14px;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            font-family: inherit;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* Desktop - GrÃ¶ÃŸere Selects */
        @media (min-width: 769px) {
            .form-group select {
                padding: 16px 20px;
                border-radius: 16px;
                font-size: 16px;
            }
        }

        /* Mobile - Touch-friendly Selects */
        @media (max-width: 480px) {
            .form-group select {
                padding: 14px 16px;
                border-radius: 12px;
                font-size: 16px; /* iOS zoom prevention */
            }
        }
        .form-group select:focus { 
            outline: none; 
            border-color: #667eea;
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        /* Responsive App Buttons */
        .btn { 
            padding: 14px 20px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            font-size: 15px;
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            font-family: inherit;
            text-decoration: none;
            width: auto;
        }

        /* Desktop - Kompakte Buttons */
        @media (min-width: 769px) {
            .btn {
                padding: 12px 24px;
                border-radius: 14px;
                font-size: 15px;
                min-height: 44px;
            }
        }

        /* Tablet */
        @media (min-width: 481px) and (max-width: 768px) {
            .btn {
                padding: 12px 20px;
                border-radius: 14px;
                font-size: 15px;
                min-height: 42px;
            }
        }

        /* Mobile - Touch-friendly Buttons */
        @media (max-width: 480px) {
            .btn {
                padding: 14px 20px;
                border-radius: 12px;
                font-size: 15px;
                min-height: 46px;
            }
        }

        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary { 
            background: rgba(255, 255, 255, 0.9);
            color: #374151;
            border: 1.5px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        .btn-secondary:hover { 
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .btn-debug { 
            background: linear-gradient(135deg, #ff416c 0%, #ff4757 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.3);
            font-size: 14px;
            padding: 12px 20px;
            min-height: 44px;
        }
        .btn-debug:hover { 
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(255, 65, 108, 0.4);
        }
        .progress-bar { 
            background: #e5e7eb; 
            height: 8px; 
            border-radius: 4px; 
            overflow: hidden;
            margin-bottom: 24px;
        }
        .progress-fill { 
            background: #f59e0b; 
            height: 100%; 
            transition: width 0.3s;
        }
        .task-item { 
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .emoji-grid { 
            display: grid; 
            grid-template-columns: repeat(6, 1fr); 
            gap: 8px; 
            margin: 12px 0;
        }
        .emoji-option { 
            aspect-ratio: 1;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .emoji-option:hover { border-color: #f59e0b; }
        .emoji-option.selected { border-color: #f59e0b; background: #fef3c7; }
        .rating-section { margin: 20px 0; }
        .slider { width: 100%; margin: 8px 0; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; }
        .preview { background: #fef3c7; padding: 16px; border-radius: 8px; margin-top: 16px; }
        .hidden { display: none; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .text-center { text-align: center; }
        .text-sm { font-size: 14px; }
        .text-gray-600 { color: #6b7280; }
        /* Responsive Typography */
        .font-bold { font-weight: 700; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }

        /* Responsive Text Sizes */
        h1 { font-size: 24px; }
        h2 { font-size: 20px; }
        h3 { font-size: 18px; }
        
        @media (min-width: 769px) {
            h1 { font-size: 28px; }
            h2 { font-size: 24px; }
            h3 { font-size: 20px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 22px; }
            h2 { font-size: 18px; }
            h3 { font-size: 16px; }
        }

        /* Responsive Flex Layouts */
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .items-center { align-items: center; }
        .gap-2 { gap: 8px; }

        /* Mobile Flex Improvements */
        @media (max-width: 480px) {
            .flex.justify-between {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .flex.justify-between > div {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
            }
        }
        .debug-info {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        /* Modal System */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .user-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .user-card {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .user-card:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .user-card.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .user-avatar {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .task-info {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .task-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            background: #f9fafb;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }

        .checklist-item:hover {
            background: #f3f4f6;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        /* Toast Notifications - App-Style Center Positioning */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: white;
            padding: 20px 28px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 320px;
            min-width: 280px;
            font-weight: 500;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .toast.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 8px;
            right: 12px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 0;
            line-height: 1;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: scale(1.1);
        }

        /* Responsive Toast Adjustments */
        @media (max-width: 480px) {
            .toast {
                max-width: calc(100% - 32px);
                min-width: calc(100% - 32px);
                margin: 0 16px;
                padding: 18px 24px;
                font-size: 15px;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .toast {
                max-width: 340px;
                min-width: 300px;
            }
        }

        /* Modern Dial/Wheel Control */
        .dial-container {
            position: relative;
            display: inline-block;
        }

        .dial-wheel {
            transform: rotate(-90deg);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .dial-progress {
            transition: stroke-dashoffset 0.3s ease;
        }

        .dial-text {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            font-weight: 600;
            fill: #1f2937;
        }

        .dial-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 60px;
            height: 60px;
            opacity: 0;
            cursor: pointer;
        }

        .dial-container:hover .dial-wheel {
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        }

        /* Absence Manager Styles */
        .absence-user-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
        }

        .absence-user-card:hover {
            border-color: #3b82f6;
            background: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .absence-user-card.selected {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .absence-entry {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .absence-entry.vacation { border-left: 4px solid #10b981; }
        .absence-entry.work { border-left: 4px solid #3b82f6; }
        .absence-entry.family { border-left: 4px solid #8b5cf6; }

        /* Profile Management Styles */
        .profile-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .profile-info h3 {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 4px;
            color: #1f2937;
        }

        .profile-stats {
            font-size: 14px;
            color: #6b7280;
            display: flex;
            gap: 16px;
            margin-top: 4px;
        }

        .profile-actions {
            display: flex;
            gap: 8px;
        }

        .profile-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .profile-actions .btn-load {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .profile-actions .btn-delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .profile-actions .btn-delete:hover {
            background: #fecaca;
        }

        .w-full { width: 100%; }
        .space-y-3 > * + * { margin-top: 12px; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="debug-banner">
            ğŸ› DEBUG MODE - VorausgefÃ¼llte Demo-Daten fÃ¼r schnelles Testen
        </div>

        <div class="container">
        <!-- WG Profile Selection Screen -->
        <div id="profileSelection" class="phase">
            <div class="debug-info">
                <strong>ğŸ  PUTZPLAN:</strong> WG-Profil auswÃ¤hlen oder neues erstellen
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-3xl mb-2">ğŸ  Putzplan Manager</h1>
                <p class="opacity-90 mb-6">WÃ¤hle dein WG-Profil oder erstelle ein neues</p>
            </div>

            <!-- Existing Profiles -->
            <div class="card">
                <h2 class="font-bold text-xl mb-4 flex items-center gap-2">
                    <i class="fas fa-users"></i>
                    Bestehende WG-Profile
                </h2>
                <div id="profileList" class="space-y-3">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
                <div id="noProfilesMessage" class="text-center py-8 text-gray-500 hidden">
                    <i class="fas fa-home text-4xl mb-4 opacity-50"></i>
                    <p>Noch keine WG-Profile erstellt</p>
                    <p class="text-sm">Erstelle dein erstes Profil!</p>
                </div>
            </div>

            <!-- New Profile Action -->
            <div class="card">
                <h2 class="font-bold text-xl mb-4 flex items-center gap-2">
                    <i class="fas fa-plus-circle"></i>
                    Neues WG-Profil
                </h2>
                <div class="space-y-3">
                    <button class="btn btn-success w-full" onclick="createNewProfile()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 16px; font-size: 16px;">
                        <i class="fas fa-plus mr-2"></i>
                        Neue WG erstellen
                    </button>
                    <button class="btn btn-primary w-full" onclick="loadDariusWG()" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); padding: 16px; font-size: 16px;">
                        <i class="fas fa-rocket mr-2"></i>
                        Darius WG (Vorkonfiguriert)
                    </button>
                </div>
            </div>

            <!-- Debug Actions -->
            <div class="card">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-tools"></i>
                    Debug & Verwaltung
                </h3>
                <div class="flex gap-2">
                    <button class="btn btn-debug" onclick="alert('âœ… JavaScript funktioniert!')">ğŸ§ª JS Test</button>
                    <button class="btn btn-debug" onclick="clearAllProfiles()">ğŸ—‘ï¸ Alle Profile lÃ¶schen</button>
                    <button class="btn btn-debug" onclick="exportProfiles()">ğŸ“¤ Profile exportieren</button>
                    <button class="btn btn-debug" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                </div>
            </div>
        </div>

        <!-- Phase 0: WG Setup -->
        <div id="phase0" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> WG-Name und Mitglieder sind vorausgefÃ¼llt
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ  WG einrichten</h1>
                <p>Zuerst die Grundlagen: Wie heiÃŸt eure WG und wer wohnt dort?</p>
            </div>

            <div class="card">
                <div class="form-group">
                    <label>Name der WG</label>
                    <input type="text" id="wgName" value="Villa Kunterbunt" />
                </div>

                <div class="form-group">
                    <label>Wie viele Personen wohnen in der WG?</label>
                    <select id="memberCount" onchange="updateMemberCount()">
                        <option value="2">2 Personen</option>
                        <option value="3" selected>3 Personen</option>
                        <option value="4">4 Personen</option>
                        <option value="5">5 Personen</option>
                        <option value="6">6 Personen</option>
                    </select>
                </div>

                <div id="memberNames">
                    <h3 class="font-bold mb-4">Namen der WG-Mitglieder:</h3>
                    <div class="form-group">
                        <label>Person 1</label>
                        <input type="text" class="member-name" value="Darius" />
                    </div>
                    <div class="form-group">
                        <label>Person 2</label>
                        <input type="text" class="member-name" value="Lilly" />
                    </div>
                    <div class="form-group">
                        <label>Person 3</label>
                        <input type="text" class="member-name" value="Hendrik I" />
                    </div>
                    <div class="form-group">
                        <label>Person 4</label>
                        <input type="text" class="member-name" value="Hendrik II" />
                    </div>
                    <div class="form-group">
                        <label>Person 5</label>
                        <input type="text" class="member-name" value="Hamza Hamza" />
                    </div>
                    <div class="form-group">
                        <label>Person 6</label>
                        <input type="text" class="member-name" value="Sofia" />
                    </div>
                </div>

                <div class="flex justify-between">
                    <div class="flex gap-2">
                        <button class="btn btn-secondary" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                        <button class="btn btn-success" onclick="setupRealWG()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">ğŸ  Darius WG Setup</button>
                        <button class="btn btn-warning" onclick="completeAutoSetup()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">âš¡ Komplett-Auto-Setup</button>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-primary" onclick="nextPhase(1)">Weiter zu Profilen â†’</button>
                        <button class="btn btn-debug" onclick="debugFillAndSkip(1)">ğŸ› Skip Phase</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 1: Individual User Creation -->
        <div id="phase1" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Profile sind vorausgefÃ¼llt - einfach durchklicken!
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ‘¤ Profil erstellen</h1>
                <p>Jetzt erstellt jede Person ihr individuelles Profil:</p>
                <div class="text-center mt-4">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                        <span id="currentMember">Anna</span> ist dran
                    </span>
                </div>
            </div>

            <div class="card">
                <h2 class="font-bold mb-4">WÃ¤hle deinen Avatar</h2>
                
                <div style="margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #374151;">ğŸ­ Emojis</h3>
                    <div class="avatar-grid">
                        <div class="avatar-option selected" onclick="selectAvatar(this, 'ğŸ˜Š')">ğŸ˜Š</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ˜')">ğŸ˜</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ¤“')">ğŸ¤“</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ˜´')">ğŸ˜´</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ¥³')">ğŸ¥³</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ˜‡')">ğŸ˜‡</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ¤”')">ğŸ¤”</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ˜‹')">ğŸ˜‹</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ™ƒ')">ğŸ™ƒ</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ¤ª')">ğŸ¤ª</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ˜Œ')">ğŸ˜Œ</div>
                        <div class="avatar-option" onclick="selectAvatar(this, 'ğŸ¤—')">ğŸ¤—</div>
                    </div>
                </div>

                <div style="margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #374151;">ğŸ‘¤ Professionelle Icons</h3>
                    <div class="avatar-grid">
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-user-circle')"><i class="fas fa-user-circle" style="font-size: 20px; color: #3b82f6;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-user-tie')"><i class="fas fa-user-tie" style="font-size: 20px; color: #1f2937;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-user-graduate')"><i class="fas fa-user-graduate" style="font-size: 20px; color: #059669;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-user-astronaut')"><i class="fas fa-user-astronaut" style="font-size: 20px; color: #7c3aed;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-user-ninja')"><i class="fas fa-user-ninja" style="font-size: 20px; color: #dc2626;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-crown')"><i class="fas fa-crown" style="font-size: 20px; color: #f59e0b;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-brain')"><i class="fas fa-brain" style="font-size: 20px; color: #ec4899;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-heart')"><i class="fas fa-heart" style="font-size: 20px; color: #ef4444;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-star')"><i class="fas fa-star" style="font-size: 20px; color: #f59e0b;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-bolt')"><i class="fas fa-bolt" style="font-size: 20px; color: #eab308;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-fire')"><i class="fas fa-fire" style="font-size: 20px; color: #f97316;"></i></div>
                        <div class="avatar-option" onclick="selectAvatarIcon(this, 'fas fa-diamond')"><i class="fas fa-gem" style="font-size: 20px; color: #06b6d4;"></i></div>
                    </div>
                </div>
            </div>

                <div class="form-group">
                    <label>Dein Name</label>
                    <input type="text" id="userName" value="Anna" />
                </div>

                <div class="form-group">
                    <label>E-Mail (optional)</label>
                    <input type="email" id="userEmail" value="anna@villa-kunterbunt.de" />
                </div>

                <div class="flex justify-between">
                    <button class="btn btn-primary" id="profileButton" onclick="nextPhase(2)">Profil speichern â†’</button>
                    <button class="btn btn-debug" onclick="debugFillAndSkip(2)">ğŸ› Skip All Profiles</button>
                </div>
            </div>
        </div>

        <!-- Phase 1b: Profile Overview -->
        <div id="phase1b" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Profile-Ãœbersicht - alle erstellen Profile ansehen und bearbeiten
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ‘¤ Profile-Ãœbersicht</h1>
                <p>Alle WG-Mitglieder und ihre Profile verwalten</p>
            </div>

            <div id="profileOverviewContainer">
                <!-- Wird dynamisch gefÃ¼llt -->
            </div>

            <div class="flex justify-between mt-4">
                <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                <div class="flex gap-2">
                    <button class="btn btn-primary" onclick="nextPhase(2)">Weiter zu Tasks â†’</button>
                    <button class="btn btn-debug" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                </div>
            </div>
        </div>

        <!-- Phase 2: Task Creation -->
        <div id="phase2" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> 5 Standard-Tasks sind vorausgefÃ¼llt
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 40%"></div>
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ“ Tasks erstellen</h1>
                <p>Welche Aufgaben fallen in der <strong id="wgNameDisplay">Villa Kunterbunt</strong> an?</p>
            </div>

            <div class="card">
                <div id="taskList">
                    <!-- DEBUG: VorausgefÃ¼llte Tasks -->
                    <div class="task-item" data-emoji="ğŸ§¹">
                        <div class="form-group">
                            <label>Task Name</label>
                            <input type="text" value="KÃ¼che putzen" />
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <input type="text" value="SpÃ¼lmaschine ausrÃ¤umen, OberflÃ¤chen wischen, Herd reinigen" />
                        </div>
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="minDaysEnabled_k0" onchange="toggleMinDays('k0', this.checked)" checked>
                                <label for="minDaysEnabled_k0" style="margin: 0;">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                            </div>
                            <div id="minDaysSlider_k0" style="margin-left: 24px;">
                                <div style="display: flex; align-items: center; gap: 16px; padding: 12px;">
                                    <div class="dial-container">
                                        <svg class="dial-wheel" width="60" height="60" viewBox="0 0 60 60">
                                            <circle cx="30" cy="30" r="25" stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
                                            <circle cx="30" cy="30" r="25" stroke="#3b82f6" stroke-width="4" fill="none" 
                                                    stroke-dasharray="157" stroke-dashoffset="150" 
                                                    id="dialProgress_k0" class="dial-progress"></circle>
                                            <text x="30" y="35" text-anchor="middle" class="dial-text" id="dialText_k0">1</text>
                                        </svg>
                                        <input type="range" class="dial-input" min="1" max="30" value="1" 
                                               oninput="updateDialMinDays('k0', this.value)" id="dialInput_k0">
                                    </div>
                                    <div style="font-size: 14px; color: #64748b;">
                                        <div><strong id="dialLabel_k0">1 Tag</strong> Mindestpause</div>
                                        <div style="font-size: 12px; margin-top: 2px;">zwischen AusfÃ¼hrungen</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Icon wÃ¤hlen</label>
                            
                            <div style="margin-bottom: 12px;">
                                <h4 style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #374151;">ğŸ§¹ Putzen & Hygiene</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option selected" onclick='selectIcon(this, "fas fa-broom", "ğŸ§¹")' data-icon="fas fa-broom"><i class="fas fa-broom"></i></div>
                                    <div class="emoji-option" onclick='selectIcon(this, "fas fa-shower", "ğŸ›")' data-icon="fas fa-shower"><i class="fas fa-shower"></i></div>
                                    <div class="emoji-option" onclick='selectIcon(this, "fas fa-soap", "ğŸ§½")' data-icon="fas fa-soap"><i class="fas fa-soap"></i></div>
                                    <div class="emoji-option" onclick='selectIcon(this, "fas fa-spray-can", "ğŸ§´")' data-icon="fas fa-spray-can"><i class="fas fa-spray-can"></i></div>
                                    <div class="emoji-option" onclick='selectIcon(this, "fas fa-toilet-paper", "ğŸ§»")' data-icon="fas fa-toilet-paper"><i class="fas fa-toilet-paper"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-bath', 'ğŸ›')" data-icon="fas fa-bath"><i class="fas fa-bath"></i></div>
                                </div>
                            </div>

                            <div style="margin-bottom: 12px;">
                                <h4 style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #374151;">ğŸ½ï¸ KÃ¼che & Essen</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-utensils', 'ğŸ½ï¸')" data-icon="fas fa-utensils"><i class="fas fa-utensils"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-coffee', 'â˜•')" data-icon="fas fa-coffee"><i class="fas fa-coffee"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-wine-glass', 'ğŸ·')" data-icon="fas fa-wine-glass"><i class="fas fa-wine-glass"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-blender', 'ğŸ¥¤')" data-icon="fas fa-blender"><i class="fas fa-blender"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-cookie-bite', 'ğŸª')" data-icon="fas fa-cookie-bite"><i class="fas fa-cookie-bite"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-pizza-slice', 'ğŸ•')" data-icon="fas fa-pizza-slice"><i class="fas fa-pizza-slice"></i></div>
                                </div>
                            </div>

                            <div style="margin-bottom: 12px;">
                                <h4 style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #374151;">ğŸ  Haushalt & Ordnung</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-home', 'ğŸ ')" data-icon="fas fa-home"><i class="fas fa-home"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-box', 'ğŸ“¦')" data-icon="fas fa-box"><i class="fas fa-box"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-trash', 'ğŸ—‘ï¸')" data-icon="fas fa-trash"><i class="fas fa-trash"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-recycle', 'â™»ï¸')" data-icon="fas fa-recycle"><i class="fas fa-recycle"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-couch', 'ğŸ›‹ï¸')" data-icon="fas fa-couch"><i class="fas fa-couch"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-bed', 'ğŸ›ï¸')" data-icon="fas fa-bed"><i class="fas fa-bed"></i></div>
                                </div>
                            </div>

                            <div style="margin-bottom: 12px;">
                                <h4 style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #374151;">ğŸ”§ Reparatur & Wartung</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-tools', 'ğŸ”§')" data-icon="fas fa-tools"><i class="fas fa-tools"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-wrench', 'ğŸ”§')" data-icon="fas fa-wrench"><i class="fas fa-wrench"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-hammer', 'ğŸ”¨')" data-icon="fas fa-hammer"><i class="fas fa-hammer"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-lightbulb', 'ğŸ’¡')" data-icon="fas fa-lightbulb"><i class="fas fa-lightbulb"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-plug', 'ğŸ”Œ')" data-icon="fas fa-plug"><i class="fas fa-plug"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-battery-half', 'ğŸ”‹')" data-icon="fas fa-battery-half"><i class="fas fa-battery-half"></i></div>
                                </div>
                            </div>

                            <div>
                                <h4 style="font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #374151;">ğŸŒ¿ Natur & Sonstiges</h4>
                                <div class="emoji-grid">
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-seedling', 'ğŸŒ±')" data-icon="fas fa-seedling"><i class="fas fa-seedling"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-leaf', 'ğŸƒ')" data-icon="fas fa-leaf"><i class="fas fa-leaf"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-car', 'ï¿½')" data-icon="fas fa-car"><i class="fas fa-car"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-bicycle', 'ğŸš´')" data-icon="fas fa-bicycle"><i class="fas fa-bicycle"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-star', 'âœ¨')" data-icon="fas fa-star"><i class="fas fa-star"></i></div>
                                    <div class="emoji-option" onclick="selectIcon(this, 'fas fa-heart', 'â¤ï¸')" data-icon="fas fa-heart"><i class="fas fa-heart"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" data-emoji="ğŸ›">
                        <div class="form-group">
                            <label>Task Name</label>
                            <input type="text" value="Bad putzen" />
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <input type="text" value="Toilette, Dusche, Waschbecken und Spiegel reinigen" />
                        </div>
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="minDaysEnabled_k1" onchange="toggleMinDays('k1', this.checked)" checked>
                                <label for="minDaysEnabled_k1" style="margin: 0;">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                            </div>
                            <div id="minDaysSlider_k1" style="margin-left: 24px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>Mindestens </span>
                                    <input type="range" class="min-days-range" min="1" max="30" value="3" style="width: 150px;" oninput="updateMinDays('k1', this.value)">
                                    <span id="minDaysValue_k1">3</span>
                                    <span> Tage Pause</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Emoji wÃ¤hlen</label>
                            <div class="emoji-grid">
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§¹')">ğŸ§¹</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ½ï¸')">ğŸ½ï¸</div>
                                <div class="emoji-option selected" onclick="selectEmoji(this, 'ğŸ›')">ğŸ›</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§½')">ğŸ§½</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ—‘ï¸')">ğŸ—‘ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§´')">ğŸ§´</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ’¡')">ğŸ’¡</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸŒ±')">ğŸŒ±</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ”§')">ğŸ”§</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ“¦')">ğŸ“¦</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ ')">ğŸ </div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'âœ¨')">âœ¨</div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" data-emoji="ğŸ—‘ï¸">
                        <div class="form-group">
                            <label>Task Name</label>
                            <input type="text" value="MÃ¼ll rausbringen" />
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <input type="text" value="Alle MÃ¼lleimer leeren und MÃ¼llsÃ¤cke zur StraÃŸe bringen" />
                        </div>
                        <div class="form-group">
                            <label>â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                            <select class="min-days-select">
                                <option value="0" selected>Kann tÃ¤glich gemacht werden</option>
                                <option value="1">Mindestens 1 Tag Pause</option>
                                <option value="2">Mindestens 2 Tage Pause</option>
                                <option value="3">Mindestens 3 Tage Pause</option>
                                <option value="7">Mindestens 1 Woche Pause</option>
                                <option value="14">Mindestens 2 Wochen Pause</option>
                                <option value="30">Nur 1x pro Monat</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Emoji wÃ¤hlen</label>
                            <div class="emoji-grid">
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§¹')">ğŸ§¹</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ½ï¸')">ğŸ½ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ›')">ğŸ›</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§½')">ğŸ§½</div>
                                <div class="emoji-option selected" onclick="selectEmoji(this, 'ğŸ—‘ï¸')">ğŸ—‘ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§´')">ğŸ§´</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ’¡')">ğŸ’¡</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸŒ±')">ğŸŒ±</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ”§')">ğŸ”§</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ“¦')">ğŸ“¦</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ ')">ğŸ </div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'âœ¨')">âœ¨</div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" data-emoji="ğŸ§½">
                        <div class="form-group">
                            <label>Task Name</label>
                            <input type="text" value="Staubsaugen" />
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <input type="text" value="Alle RÃ¤ume und Flure staubsaugen" />
                        </div>
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="minDaysEnabled_3" onchange="toggleMinDays(3, this.checked)" checked>
                                <label for="minDaysEnabled_3" style="margin: 0;">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                            </div>
                            <div id="minDaysSlider_3" style="margin-left: 24px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>Mindestens </span>
                                    <input type="range" class="min-days-range" min="1" max="30" value="7" style="width: 150px;" oninput="updateMinDays(3, this.value)">
                                    <span id="minDaysValue_3">7</span>
                                    <span> Tage Pause</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Emoji wÃ¤hlen</label>
                            <div class="emoji-grid">
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§¹')">ğŸ§¹</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ½ï¸')">ğŸ½ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ›')">ğŸ›</div>
                                <div class="emoji-option selected" onclick="selectEmoji(this, 'ğŸ§½')">ğŸ§½</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ—‘ï¸')">ğŸ—‘ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§´')">ğŸ§´</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ’¡')">ğŸ’¡</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸŒ±')">ğŸŒ±</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ”§')">ğŸ”§</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ“¦')">ğŸ“¦</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ ')">ğŸ </div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'âœ¨')">âœ¨</div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" data-emoji="ğŸŒ±">
                        <div class="form-group">
                            <label>Task Name</label>
                            <input type="text" value="Pflanzen gieÃŸen" />
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <input type="text" value="Alle Zimmerpflanzen und Balkonpflanzen gieÃŸen" />
                        </div>
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="minDaysEnabled_4" onchange="toggleMinDays(4, this.checked)" checked>
                                <label for="minDaysEnabled_4" style="margin: 0;">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                            </div>
                            <div id="minDaysSlider_4" style="margin-left: 24px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>Mindestens </span>
                                    <input type="range" class="min-days-range" min="1" max="30" value="2" style="width: 150px;" oninput="updateMinDays(4, this.value)">
                                    <span id="minDaysValue_4">2</span>
                                    <span> Tage Pause</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Emoji wÃ¤hlen</label>
                            <div class="emoji-grid">
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§¹')">ğŸ§¹</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ½ï¸')">ğŸ½ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ›')">ğŸ›</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§½')">ğŸ§½</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ—‘ï¸')">ğŸ—‘ï¸</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ§´')">ğŸ§´</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ’¡')">ğŸ’¡</div>
                                <div class="emoji-option selected" onclick="selectEmoji(this, 'ğŸŒ±')">ğŸŒ±</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ”§')">ğŸ”§</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ“¦')">ğŸ“¦</div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'ğŸ ')">ğŸ </div>
                                <div class="emoji-option" onclick="selectEmoji(this, 'âœ¨')">âœ¨</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between">
                    <div class="flex gap-2">
                        <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                        <button class="btn btn-secondary" onclick="addTask()">+ Weiteren Task hinzufÃ¼gen</button>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-primary mt-4" onclick="nextPhase('2_5')">Weiter zur Bewertung â†’</button>
                        <button class="btn btn-debug mt-4" onclick="debugFillAndSkip(3)">ğŸ› Skip Phase</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2.5: User Overview -->
        <div id="phase2_5" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> BenutzerÃ¼bersicht - WÃ¤hle aus, wer bewerten soll
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 60%"></div>
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ‘¥ Wer soll bewerten?</h1>
                <p>WÃ¤hle ein WG-Mitglied aus, um die Tasks zu bewerten:</p>
            </div>

            <div class="card">
                <div id="userOverviewList">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>

                <div class="flex justify-between mt-4">
                    <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                    <div>
                        <button class="btn btn-primary" onclick="startAllRatings()" style="display: none;" id="startAllBtn">Alle fertig - Weiter â†’</button>
                        <button class="btn btn-debug" onclick="debugFillAllRatings()">ğŸ› Fill All Ratings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: Collaborative Rating -->
        <div id="phase3" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Slider-Werte werden automatisch gesetzt
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 80%"></div>
            </div>

            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ¯ Task bewerten</h1>
                <p><strong id="ratingMemberName">Anna</strong>, bewerte jeden Task nach deiner EinschÃ¤tzung:</p>
                <div class="text-center mt-4">
                    <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full inline-block mb-2">
                        Person <span id="currentRatingMember">1</span> von <span id="totalMembers">3</span>
                    </div>
                    <br>
                    <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full inline-block">
                        Task <span id="currentTask">1</span> von <span id="totalTasks">5</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="text-center mb-4">
                    <div style="font-size: 48px; margin-bottom: 8px;" id="taskEmoji">ğŸ§¹</div>
                    <h2 class="font-bold" id="taskTitle">KÃ¼che putzen</h2>
                    <p class="text-gray-600" id="taskDescription">SpÃ¼lmaschine ausrÃ¤umen, OberflÃ¤chen wischen...</p>
                </div>

                <div class="rating-section">
                    <label class="font-bold mb-2">â±ï¸ Wie lange brauchst DU fÃ¼r diesen Task? (<span id="minutesValue">30</span> Min.)</label>
                    <input type="range" class="slider" min="5" max="120" step="5" value="30" 
                           onchange="updateValue('minutesValue', this.value)" />
                    <div class="slider-labels">
                        <span>5 Min</span>
                        <span>2h</span>
                    </div>
                </div>

                <div class="rating-section">
                    <label class="font-bold mb-2">ğŸ˜¤ Wie nervig ist dieser Task? (<span id="painValue">5</span>/10)</label>
                    <input type="range" class="slider" min="1" max="10" value="5" 
                           onchange="updateValue('painValue', this.value)" />
                    <div class="slider-labels">
                        <span>ğŸ˜Š Entspannt</span>
                        <span>ğŸ˜¤ Sehr nervig</span>
                    </div>
                </div>

                <div class="rating-section">
                    <label class="font-bold mb-2">â­ Wie wichtig ist dieser Task? (<span id="importanceValue">5</span>/10)</label>
                    <input type="range" class="slider" min="1" max="10" value="5" 
                           onchange="updateValue('importanceValue', this.value)" />
                    <div class="slider-labels">
                        <span>Kann warten</span>
                        <span>Sehr wichtig</span>
                    </div>
                </div>

                <div class="rating-section">
                    <label class="font-bold mb-2">ğŸ“… Wie oft pro Monat? (<span id="frequencyValue">4</span>x)</label>
                    <input type="range" class="slider" min="1" max="30" value="4" 
                           onchange="updateValue('frequencyValue', this.value)" />
                    <div class="slider-labels">
                        <span>1x</span>
                        <span>TÃ¤glich</span>
                    </div>
                </div>

                <div class="preview">
                    <h3 class="font-bold mb-2">Deine Bewertung:</h3>
                    <div class="flex justify-between">
                        <span>Punkte pro Task: <strong id="taskPoints">38</strong></span>
                        <span>Punkte pro Monat: <strong id="monthlyPoints">152</strong></span>
                    </div>
                </div>

                <div class="flex justify-between mt-4">
                    <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                    <div>
                        <button class="btn btn-primary" onclick="nextTask()">NÃ¤chster Task â†’</button>
                        <button class="btn btn-debug" onclick="debugAutoRate()">ğŸ› Auto-Rate</button>
                    </div>
                </div>
            </div>

            <div class="card" style="background: #f0fdf4; border: 2px solid #bbf7d0;">
                <div class="text-center">
                    <h3 class="font-bold mb-2">â„¹ï¸ Info</h3>
                    <p class="text-sm">
                        SpÃ¤ter werden alle Bewertungen der WG-Mitglieder gemittelt.<br>
                        Formel: (Minuten + Minuten Ã— Pain Ã— 0.1) Ã— (Wichtigkeit Ã· 10)
                    </p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="phaseComplete" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Haupt-Dashboard - Navigation zu verschiedenen Bereichen
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ï¿½ WG Dashboard</h1>
                <p><strong id="dashboardWgName">Villa Kunterbunt</strong> - Putzplan App</p>
                <div style="margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="showProfileSelection()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 14px; padding: 8px 16px;">
                        <i class="fas fa-exchange-alt mr-1"></i>
                        Profil wechseln
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 class="font-bold mb-4">ğŸ“Š SchnellÃ¼bersicht</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <div class="card bg-blue-50" style="padding: 16px;">
                        <div class="text-center">
                            <div style="font-size: 24px; font-weight: bold;" id="totalTasksCount">5</div>
                            <div class="text-sm text-gray-600">Tasks aktiv</div>
                        </div>
                    </div>
                    <div class="card bg-green-50" style="padding: 16px;">
                        <div class="text-center">
                            <div style="font-size: 24px; font-weight: bold;" id="completedTasksToday">0</div>
                            <div class="text-sm text-gray-600">Heute erledigt</div>
                        </div>
                    </div>
                </div>
                
                <h3 class="font-bold mb-4">ğŸ§­ Navigation</h3>
                <div style="display: grid; gap: 12px;">
                    <button class="btn btn-primary" onclick="showTaskTable()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-table" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">Tabellen-Ãœbersicht</div>
                                <div class="text-sm opacity-80">Tasks erledigen und verfolgen</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <button class="btn btn-secondary" onclick="showTaskManagement()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-cog" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">Tasks bearbeiten</div>
                                <div class="text-sm opacity-80">Namen Ã¤ndern, Pausen einstellen, Checklisten</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <button class="btn btn-secondary" onclick="showSetupSummary()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-chart-bar" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">Setup-Ãœbersicht</div>
                                <div class="text-sm opacity-80">Bewertungen und Statistiken ansehen</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <button class="btn btn-warning" onclick="showAbsenceManager()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-calendar-times" style="width: 20px; color: white;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold" style="color: white;">Abwesenheit melden</div>
                                <div class="text-sm opacity-90" style="color: white;">Urlaub/GeschÃ¤ftsreise eintragen</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: white;"></i>
                    </button>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button class="btn btn-debug" onclick="location.reload()">ğŸ› Neues Setup</button>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                        <button class="btn btn-primary" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Management Page -->
        <div id="taskManagement" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Task-Verwaltung - Bearbeiten von Namen, Pausen und Checklisten
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">âš™ï¸ Tasks bearbeiten</h1>
                <p>Namen Ã¤ndern, MindestabstÃ¤nde anpassen und Checklisten erstellen</p>
            </div>

            <div class="card">
                <div id="taskManagementList">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
                
                <div class="flex justify-between mt-4">
                    <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                    <div class="flex gap-2">
                        <button class="btn btn-primary" onclick="saveTaskChanges()">Ã„nderungen speichern</button>
                        <button class="btn btn-primary" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Table Page -->
        <div id="taskTable" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› DEBUG:</strong> Task-Tabelle - Tasks erledigen und verfolgen
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ“‹ Task-Tabelle</h1>
                <p>Klicke auf einen Task-Namen um ihn zu erledigen</p>
            </div>

            <div class="card">
                <div style="overflow-x: auto; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                    <table id="taskTableGrid" style="width: 100%; border-collapse: collapse; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                        <!-- Wird dynamisch gefÃ¼llt -->
                    </table>
                </div>
                
                <div class="flex justify-between mt-4">
                    <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
                    <div class="flex gap-2">
                        <button class="btn btn-debug" onclick="addRandomTaskExecution()">ğŸ› Random Task hinzufÃ¼gen</button>
                        <button class="btn btn-primary" onclick="showMasterOverview()">ğŸ›ï¸ Master-Ãœbersicht</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Absence Manager Page -->
        <div id="absenceManager" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ–ï¸ ABWESENHEIT:</strong> Urlaub, GeschÃ¤ftsreisen oder Familien-Angelegenheiten verwalten
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ–ï¸ Abwesenheit melden</h1>
                <p>Trage deine Abwesenheitszeiten ein fÃ¼r faire Punkteverteilung</p>
            </div>

            <!-- User Selection -->
            <div class="card" id="absenceUserSelection">
                <h3 class="font-bold mb-3">ğŸ‘¤ Wer war/ist abwesend?</h3>
                <div class="avatar-grid" id="absenceUserGrid">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
            </div>

            <!-- Date Selection with Calendar -->
            <div class="card hidden" id="absenceDateSelection">
                <h3 class="font-bold mb-3">ğŸ“… Abwesenheitszeitraum</h3>
                <div style="margin-bottom: 16px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Grund der Abwesenheit</label>
                    <select id="absenceReason" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px;">
                        <option value="vacation">ğŸ–ï¸ Urlaub</option>
                        <option value="sick">ğŸ¤’ Krank</option>
                        <option value="work">ğŸ’¼ GeschÃ¤ftsreise</option>
                        <option value="family">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familie/Besuch</option>
                        <option value="other">â“ Sonstiges</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Von Datum</label>
                        <input type="date" id="absenceStartDate" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Bis Datum</label>
                        <input type="date" id="absenceEndDate" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px;">
                    </div>
                </div>

                <div id="absenceSummary" class="hidden" style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 16px;">
                    <h4 style="font-weight: 600; margin-bottom: 8px;">ğŸ“Š Auswirkung auf Zielpunkte</h4>
                    <div id="absenceImpact"></div>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="cancelAbsenceEntry()">Abbrechen</button>
                    <button class="btn btn-primary" onclick="saveAbsence()">Abwesenheit speichern</button>
                </div>
            </div>

            <!-- Absence Overview -->
            <div class="card">
                <h3 class="font-bold mb-3">ğŸ“‹ Aktuelle Abwesenheiten</h3>
                <div id="absenceList">
                    <!-- Wird dynamisch gefÃ¼llt -->
                </div>
            </div>

            <div class="flex justify-between mt-4">
                <button class="btn btn-secondary" onclick="showDashboard()">â† ZurÃ¼ck zum Dashboard</button>
                <div class="flex gap-2">
                    <button class="btn btn-debug" onclick="cleanupDuplicateAbsences()">ğŸ§¹ Duplikate bereinigen</button>
                    <button class="btn btn-debug" onclick="addDemoAbsences()">ğŸ› Demo-Abwesenheiten</button>
                </div>
            </div>
        </div>

        <!-- Master Overview Page -->
        <div id="masterOverview" class="phase hidden">
            <div class="debug-info">
                <strong>ğŸ› MASTER:</strong> Vollzugriff auf alle Bereiche des Workflows
            </div>
            
            <div class="card gradient-bg">
                <h1 class="font-bold text-2xl mb-2">ğŸ›ï¸ Master-Ãœbersicht</h1>
                <p>VollstÃ¤ndige Navigation durch den gesamten Workflow</p>
            </div>

            <!-- Setup Bereich -->
            <div class="card">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-cogs"></i>
                    Setup & Konfiguration
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <button class="btn btn-secondary" onclick="showPhase('phase0')" style="padding: 12px;">
                        <div class="text-left">
                            <div class="font-bold">ğŸ“ WG Setup</div>
                            <div class="text-sm opacity-80">Namen & Mitglieder</div>
                        </div>
                    </button>
                    <button class="btn btn-secondary" onclick="showPhase('phase1b')" style="padding: 12px;">
                        <div class="text-left">
                            <div class="font-bold">ğŸ‘¤ Profile</div>
                            <div class="text-sm opacity-80">Avatars & E-Mails</div>
                        </div>
                    </button>
                    <button class="btn btn-secondary" onclick="showPhase('phase2')" style="padding: 12px;">
                        <div class="text-left">
                            <div class="font-bold">ğŸ“‹ Tasks</div>
                            <div class="text-sm opacity-80">Task-Erstellung</div>
                        </div>
                    </button>
                    <button class="btn btn-secondary" onclick="showPhase('phase2_5')" style="padding: 12px;">
                        <div class="text-left">
                            <div class="font-bold">ğŸ‘¥ Bewertungen</div>
                            <div class="text-sm opacity-80">User-Ãœbersicht</div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Hauptbereiche -->
            <div class="card">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-home"></i>
                    Hauptbereiche
                </h3>
                <div style="display: grid; gap: 12px;">
                    <button class="btn btn-primary" onclick="showDashboard()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-tachometer-alt" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">ğŸ  Dashboard</div>
                                <div class="text-sm opacity-80">HauptÃ¼bersicht mit Statistiken</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <button class="btn btn-primary" onclick="showTaskTable()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-table" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">ğŸ“Š Task-Tabelle</div>
                                <div class="text-sm opacity-80">Tasks erledigen & verfolgen</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <button class="btn btn-primary" onclick="showTaskManagement()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-edit" style="width: 20px;"></i>
                            <div style="text-align: left;">
                                <div class="font-bold">âš™ï¸ Task-Verwaltung</div>
                                <div class="text-sm opacity-80">Tasks bearbeiten & Checklisten</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Status & Debug -->
            <div class="card">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-info-circle"></i>
                    Status & Debug
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div class="card bg-blue-50" style="padding: 12px;">
                        <div class="text-sm font-bold">WG</div>
                        <div id="masterWgName" class="text-lg">-</div>
                    </div>
                    <div class="card bg-green-50" style="padding: 12px;">
                        <div class="text-sm font-bold">Mitglieder</div>
                        <div id="masterMemberCount" class="text-lg">-</div>
                    </div>
                    <div class="card bg-yellow-50" style="padding: 12px;">
                        <div class="text-sm font-bold">Tasks</div>
                        <div id="masterTaskCount" class="text-lg">-</div>
                    </div>
                    <div class="card bg-purple-50" style="padding: 12px;">
                        <div class="text-sm font-bold">Bewertungen</div>
                        <div id="masterRatingsCount" class="text-lg">-</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="btn btn-debug" onclick="location.reload()">ğŸ”„ Komplett neu starten</button>
                    <button class="btn btn-debug" onclick="debugFillAllData()">ğŸ› Alle Daten fÃ¼llen</button>
                </div>
            </div>
            
            <div class="flex justify-center mt-4">
                <button class="btn btn-secondary" onclick="goBack()">â† ZurÃ¼ck</button>
            </div>
        </div>
    </div>

    <!-- Task Execution Modal -->
    <div id="taskExecutionModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 style="margin: 0; font-size: 20px; font-weight: 600;">Task erledigen</h2>
            </div>
            <div class="modal-body">
                <div id="taskInfoSection" class="task-info">
                    <div class="task-title">
                        <span id="modalTaskEmoji">ğŸ§¹</span>
                        <span id="modalTaskName">KÃ¼che putzen</span>
                    </div>
                    <p id="modalTaskDescription" style="margin: 0; opacity: 0.9;">SpÃ¼lmaschine ausrÃ¤umen, OberflÃ¤chen wischen</p>
                </div>

                <div id="userSelectionSection">
                    <h3 style="margin: 0 0 8px; font-size: 16px; font-weight: 600;">Wer erledigt diesen Task?</h3>
                    <p style="margin: 0 0 16px; color: #6b7280; font-size: 14px;">WÃ¤hle dein Profil aus:</p>
                    <div id="modalUserGrid" class="user-selection-grid">
                        <!-- Wird dynamisch gefÃ¼llt -->
                    </div>
                </div>

                <div id="checklistSection" style="display: none;">
                    <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">ğŸ“‹ Checklist abarbeiten</h3>
                    <div id="modalChecklist">
                        <!-- Wird dynamisch gefÃ¼llt -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modalCancelBtn" class="btn btn-secondary">Abbrechen</button>
                <button id="modalExecuteBtn" class="btn btn-primary" disabled>Task erledigt! âœ“</button>
            </div>
        </div>
    </div>

    <script>
        let wgName = 'WG Darius & Co';
        let memberNames = ['Darius', 'Lilly', 'Hendrik I', 'Hendrik II', 'Hamza Hamza', 'Sofia'];
        let currentMemberIndex = 0;
        let memberProfiles = [];
        let selectedAvatar = 'ğŸ˜Š';
        let tasks = [];
        let currentTaskIndex = 0;
        let currentRatingMemberIndex = 0;
        let allRatings = {};

        // Debug-Daten fÃ¼r schnelle Navigation
        const debugProfiles = [
            { name: 'Darius', avatar: 'ï¿½', email: 'darius@wg-darius.de' },
            { name: 'Lilly', avatar: 'ğŸŒ¸', email: 'lilly@wg-darius.de' },
            { name: 'Hendrik I', avatar: 'ğŸ¤“', email: 'hendrik1@wg-darius.de' },
            { name: 'Hendrik II', avatar: 'ï¿½', email: 'hendrik2@wg-darius.de' },
            { name: 'Hamza Hamza', avatar: 'ğŸš€', email: 'hamza@wg-darius.de' },
            { name: 'Sofia', avatar: 'âœ¨', email: 'sofia@wg-darius.de' }
        ];

        const debugTasks = [
            { 
                title: 'Hallway', 
                description: 'Flur und Eingangsbereich reinigen', 
                emoji: 'ğŸ ', 
                minDaysBetween: 7,
                checklist: [
                    'Boden fegen und wischen',
                    'Schuhe ordnen',
                    'Garderobe aufrÃ¤umen',
                    'Spiegel putzen',
                    'Pflanzen gieÃŸen falls vorhanden'
                ]
            },
            { 
                title: 'Big bathroom + shower', 
                description: 'GroÃŸes Bad und Dusche grÃ¼ndlich reinigen', 
                emoji: 'ğŸ›', 
                minDaysBetween: 7,
                checklist: [
                    'Dusche entkalken und schrubben',
                    'Toilette innen und auÃŸen reinigen',
                    'Waschbecken und Armaturen putzen',
                    'Spiegel und Fliesen wischen',
                    'Boden wischen und HandtÃ¼cher wechseln'
                ]
            },
            { 
                title: 'Small bath + livingroom', 
                description: 'Kleines Bad und Wohnzimmer sÃ¤ubern', 
                emoji: 'ğŸ›‹ï¸', 
                minDaysBetween: 7,
                checklist: [
                    'GÃ¤ste-WC reinigen',
                    'Wohnzimmer staubsaugen',
                    'OberflÃ¤chen abstauben',
                    'Kissen aufschÃ¼tteln',
                    'Ordnung schaffen'
                ]
            },
            { 
                title: 'Kitchen', 
                description: 'KÃ¼che komplett reinigen', 
                emoji: 'ğŸ³', 
                minDaysBetween: 3,
                checklist: [
                    'SpÃ¼lmaschine ausrÃ¤umen',
                    'ArbeitsflÃ¤chen desinfizieren',
                    'Herd und Backofen sÃ¤ubern',
                    'SpÃ¼le und Wasserhahn putzen',
                    'Boden wischen'
                ]
            },
            { 
                title: 'Plastic trash tuesday', 
                description: 'PlastikmÃ¼ll am Dienstag rausbringen', 
                emoji: 'â™»ï¸', 
                minDaysBetween: 7,
                checklist: [
                    'Alle PlastikmÃ¼lleimer leeren',
                    'Gelben Sack bereitstellen',
                    'Zur StraÃŸe bringen (Dienstag morgens)',
                    'Neue MÃ¼llbeutel einsetzen',
                    'MÃ¼lltonne zurÃ¼ckstellen'
                ]
            },
            { 
                title: 'Wg clothes clean + hang', 
                description: 'WG-WÃ¤sche waschen und aufhÃ¤ngen', 
                emoji: 'ï¿½', 
                minDaysBetween: 14,
                checklist: [
                    'HandtÃ¼cher und BettwÃ¤sche sammeln',
                    'Waschmaschine starten',
                    'WÃ¤sche aufhÃ¤ngen',
                    'Getrocknete WÃ¤sche abhÃ¤ngen',
                    'WÃ¤schekÃ¶rbe zurÃ¼ck an PlÃ¤tze'
                ]
            },
            { 
                title: 'Vg clothes put away', 
                description: 'WG-WÃ¤sche zusammenlegen und wegrÃ¤umen', 
                emoji: 'ğŸ‘”', 
                minDaysBetween: 14,
                checklist: [
                    'Trockene WÃ¤sche abnehmen',
                    'HandtÃ¼cher zusammenlegen',
                    'BettwÃ¤sche sortieren',
                    'Alles an richtige PlÃ¤tze rÃ¤umen',
                    'WÃ¤schekÃ¶rbe aufrÃ¤umen'
                ]
            },
            { 
                title: 'Wg shopping', 
                description: 'Gemeinsame WG-EinkÃ¤ufe erledigen', 
                emoji: 'ğŸ›’', 
                minDaysBetween: 7,
                checklist: [
                    'Einkaufsliste erstellen',
                    'Putzmittel und Toilettenpapier kaufen',
                    'KÃ¼chenverbrauchsgegenstÃ¤nde besorgen',
                    'GlÃ¼hbirnen und Batterien checken',
                    'Bon sammeln fÃ¼r Abrechnung'
                ]
            },
            { 
                title: 'Unclogging shower', 
                description: 'Duschablauf von Verstopfungen befreien', 
                emoji: 'ğŸš¿', 
                minDaysBetween: 30,
                checklist: [
                    'Duschsieb entfernen',
                    'Haare und Schmutz entfernen',
                    'Abfluss mit Rohrreiniger behandeln',
                    'Mit heiÃŸem Wasser spÃ¼len',
                    'Sieb wieder einsetzen'
                ]
            },
            { 
                title: 'Biotrash + clean', 
                description: 'BiomÃ¼ll entsorgen und BehÃ¤lter reinigen', 
                emoji: 'ğŸ—‘ï¸', 
                minDaysBetween: 7,
                checklist: [
                    'BiomÃ¼ll-Eimer leeren',
                    'Eimer grÃ¼ndlich auswaschen',
                    'Neue TÃ¼te einlegen',
                    'BiomÃ¼ll zur Tonne bringen',
                    'Tonne zurÃ¼ckstellen nach Abholung'
                ]
            },
            { 
                title: 'RestmÃ¼ll + clean', 
                description: 'RestmÃ¼ll entsorgen und sÃ¤ubern', 
                emoji: 'ğŸ—‘ï¸', 
                minDaysBetween: 14,
                checklist: [
                    'Alle RestmÃ¼lleimer leeren',
                    'MÃ¼lleimer auswischen',
                    'Neue MÃ¼llbeutel einsetzen',
                    'Zur StraÃŸe bringen',
                    'Tonne nach Abholung zurÃ¼ckholen'
                ]
            },
            { 
                title: 'Plastic', 
                description: 'PlastikmÃ¼ll sortieren und entsorgen', 
                emoji: 'â™»ï¸', 
                minDaysBetween: 14,
                checklist: [
                    'Plastikverpackungen sammeln',
                    'Sauber ausspÃ¼len',
                    'In gelben Sack sortieren',
                    'Zur Abholung bereitstellen',
                    'Neue SammelbehÃ¤lter aufstellen'
                ]
            },
            { 
                title: 'Paper', 
                description: 'Altpapier sammeln und entsorgen', 
                emoji: 'ğŸ“„', 
                minDaysBetween: 21,
                checklist: [
                    'Altpapier aus allen RÃ¤umen sammeln',
                    'Kartons zerkleinern',
                    'In Papiertonne sortieren',
                    'Zur Abholung bereitstellen',
                    'PapierkÃ¶rbe leeren'
                ]
            },
            { 
                title: 'Pfand', 
                description: 'Pfandflaschen sammeln und zurÃ¼ckbringen', 
                emoji: 'ğŸ¾', 
                minDaysBetween: 14,
                checklist: [
                    'Leere Flaschen aus KÃ¼che sammeln',
                    'Pfandkisten befÃ¼llen',
                    'Zum Supermarkt bringen',
                    'Pfandbon einlÃ¶sen',
                    'Geld in WG-Kasse'
                ]
            },
            { 
                title: 'dishwasher', 
                description: 'SpÃ¼lmaschine bedienen und warten', 
                emoji: 'ï¿½ï¸', 
                minDaysBetween: 2,
                checklist: [
                    'SpÃ¼lmaschine ausrÃ¤umen',
                    'Neu beladen',
                    'Tabs und KlarspÃ¼ler prÃ¼fen',
                    'Programm starten',
                    'Filter regelmÃ¤ÃŸig reinigen'
                ]
            },
            { 
                title: 'Attik clean', 
                description: 'Dachboden/Speicher aufrÃ¤umen', 
                emoji: 'ğŸ ', 
                minDaysBetween: 90,
                checklist: [
                    'Staub wischen und fegen',
                    'Kartons sortieren',
                    'Ungenutztes aussortieren',
                    'Ordnung schaffen',
                    'SchÃ¤dlinge kontrollieren'
                ]
            },
            { 
                title: 'Fridge', 
                description: 'KÃ¼hlschrank reinigen und sortieren', 
                emoji: 'â„ï¸', 
                minDaysBetween: 30,
                checklist: [
                    'Abgelaufene Produkte entfernen',
                    'FÃ¤cher herausnehmen und waschen',
                    'Innenraum desinfizieren',
                    'GemÃ¼sefach sÃ¤ubern',
                    'Wieder ordentlich einrÃ¤umen'
                ]
            },
            { 
                title: 'SpÃ¼lrack', 
                description: 'Abtropfgestell reinigen und ordnen', 
                emoji: 'ğŸ§½', 
                minDaysBetween: 7,
                checklist: [
                    'Abtropfgestell komplett leeren',
                    'Mit SpÃ¼lmittel reinigen',
                    'WasserfÃ¤cher sÃ¤ubern',
                    'Geschirr richtig einsortieren',
                    'Umgebung trocken wischen'
                ]
            }
        ];

        // Debug-Bewertungen (verschiedene Profile haben verschiedene PrÃ¤ferenzen)
        const debugRatings = {
            'Anna': {
                'KÃ¼che putzen': { minutes: 25, pain: 3, importance: 9, frequency: 6 },
                'Bad putzen': { minutes: 35, pain: 7, importance: 8, frequency: 4 },
                'MÃ¼ll rausbringen': { minutes: 10, pain: 2, importance: 7, frequency: 8 },
                'Staubsaugen': { minutes: 20, pain: 4, importance: 6, frequency: 2 },
                'Pflanzen gieÃŸen': { minutes: 15, pain: 1, importance: 5, frequency: 12 }
            },
            'Ben': {
                'KÃ¼che putzen': { minutes: 30, pain: 4, importance: 8, frequency: 6 },
                'Bad putzen': { minutes: 40, pain: 8, importance: 9, frequency: 3 },
                'MÃ¼ll rausbringen': { minutes: 8, pain: 1, importance: 6, frequency: 10 },
                'Staubsaugen': { minutes: 25, pain: 3, importance: 7, frequency: 2 },
                'Pflanzen gieÃŸen': { minutes: 12, pain: 2, importance: 4, frequency: 15 }
            },
            'Clara': {
                'KÃ¼che putzen': { minutes: 35, pain: 5, importance: 9, frequency: 5 },
                'Bad putzen': { minutes: 30, pain: 6, importance: 8, frequency: 4 },
                'MÃ¼ll rausbringen': { minutes: 12, pain: 3, importance: 8, frequency: 7 },
                'Staubsaugen': { minutes: 18, pain: 2, importance: 8, frequency: 3 },
                'Pflanzen gieÃŸen': { minutes: 20, pain: 1, importance: 6, frequency: 10 }
            }
        };

        function selectAvatar(element, avatar) {
            document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedAvatar = avatar;
        }

        function selectAvatarIcon(element, iconClass) {
            document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedAvatar = `<i class="${iconClass}" style="font-size: 18px;"></i>`;
        }

        function toggleIconSelector(button) {
            const taskItem = button.closest('.task-item');
            const selector = taskItem.querySelector('.extended-icon-selector');
            
            if (selector.style.display === 'none' || !selector.style.display) {
                selector.style.display = 'block';
                button.innerHTML = 'ğŸ”¼ Weniger Icons';
            } else {
                selector.style.display = 'none';
                button.innerHTML = 'ğŸ“‹ Mehr Icons';
            }
        }

        function setupRealWG() {
            console.log('ğŸ  setupRealWG() - Darius WG Setup gestartet!');
            try {
                if (!confirm('ğŸ  Darius WG Setup starten?\n\nDas richtet eure echte WG ein:\nâ€¢ Darius, Lilly, Hendrik I, Hendrik II, Hamza Hamza, Sofia\nâ€¢ Alle echten Tasks aus eurem Plan\nâ€¢ Realistische Profile und Ratings\n\nDanach gehts direkt zum Dashboard!')) {
                    return;
                }

                showSuccessToast('ğŸ  Darius WG wird eingerichtet...');

                // Echte WG-Daten setzen
                wgName = 'WG Darius & Co';
                memberNames = ['Darius', 'Lilly', 'Hendrik I', 'Hendrik II', 'Hamza Hamza', 'Sofia'];
                
                // Echte Profile erstellen
                memberProfiles = [
                    { name: 'Darius', avatar: 'ğŸ˜', email: 'darius@wg-darius.de' },
                    { name: 'Lilly', avatar: 'ğŸŒ¸', email: 'lilly@wg-darius.de' },
                    { name: 'Hendrik I', avatar: 'ğŸ¤“', email: 'hendrik1@wg-darius.de' },
                    { name: 'Hendrik II', avatar: 'ğŸ˜Š', email: 'hendrik2@wg-darius.de' },
                    { name: 'Hamza Hamza', avatar: 'ğŸš€', email: 'hamza@wg-darius.de' },
                    { name: 'Sofia', avatar: 'âœ¨', email: 'sofia@wg-darius.de' }
                ];

                // Echte Tasks setzen (aus debugTasks Ã¼bernehmen)
                tasks = debugTasks.map(task => ({...task}));

                // Realistische Ratings fÃ¼r alle Mitglieder und Tasks
                ratings = {};
                allRatings = {};
                memberProfiles.forEach(member => {
                    ratings[member.name] = {};
                    allRatings[member.name] = {};
                    
                    tasks.forEach(task => {
                        // Spezifischere Ratings je nach Task-Typ
                        let minutes, pain, importance, frequency;
                        
                        if (task.title.includes('trash') || task.title.includes('MÃ¼ll')) {
                            minutes = Math.floor(Math.random() * 15) + 5; // 5-20 min
                            pain = Math.floor(Math.random() * 2) + 1;    // 1-2 pain
                            importance = Math.floor(Math.random() * 2) + 4; // 4-5 importance
                            frequency = 1; // hÃ¤ufig
                        } else if (task.title.includes('bathroom') || task.title.includes('Bad')) {
                            minutes = Math.floor(Math.random() * 30) + 20; // 20-50 min
                            pain = Math.floor(Math.random() * 3) + 3;     // 3-5 pain
                            importance = Math.floor(Math.random() * 2) + 4; // 4-5 importance
                            frequency = Math.floor(Math.random() * 2) + 2; // 2-3
                        } else if (task.title.includes('Kitchen') || task.title.includes('dishwasher')) {
                            minutes = Math.floor(Math.random() * 25) + 15; // 15-40 min
                            pain = Math.floor(Math.random() * 2) + 2;     // 2-3 pain
                            importance = 5; // sehr wichtig
                            frequency = 1; // hÃ¤ufig
                        } else {
                            minutes = Math.floor(Math.random() * 40) + 10; // 10-50 min
                            pain = Math.floor(Math.random() * 4) + 2;     // 2-5 pain
                            importance = Math.floor(Math.random() * 3) + 3; // 3-5 importance
                            frequency = Math.floor(Math.random() * 3) + 2; // 2-4
                        }
                        
                        const rating = {
                            minutes: minutes,
                            pain: pain,
                            importance: importance,
                            frequency: frequency,
                            points: Math.round((minutes * 0.5) + (pain * 2) + (importance * 1.5))
                        };
                        
                        ratings[member.name][task.title] = rating;
                        allRatings[member.name][task.title] = rating;
                    });
                });

                // Task executions initialisieren
                taskExecutions = {};
                memberProfiles.forEach(member => {
                    taskExecutions[member.name] = {};
                    tasks.forEach(task => {
                        taskExecutions[member.name][task.title] = [];
                    });
                });

                // Speichern
                saveCurrentState();
                
                showSuccessToast('âœ… Darius WG erfolgreich eingerichtet! Zum Dashboard...');
                
                // Direkt zum Dashboard
                setTimeout(() => {
                    showDashboard();
                }, 2000);
                
            } catch (error) {
                console.error('âŒ Fehler in setupRealWG:', error);
                alert('âŒ Fehler beim WG-Setup: ' + error.message);
            }
        }

        function completeAutoSetup() {
            console.log('ğŸ”¥ completeAutoSetup() aufgerufen!');
            try {
                if (!confirm('âš¡ Komplett-Auto-Setup starten?\n\nDas fÃ¼llt automatisch ALLES aus:\nâ€¢ WG-Name & Mitglieder\nâ€¢ Alle Profile mit zufÃ¤lligen Avatars\nâ€¢ Alle Task-Ratings\nâ€¢ Tasks mit Icons\n\nDanach gehts direkt zum Dashboard!')) {
                    return;
                }

                showSuccessToast('âš¡ Auto-Setup gestartet...');

            // Phase 0: WG-Setup 
            wgName = document.getElementById('wgName').value || 'Auto-WG';
            
            // Sammle alle Member-Namen
            memberNames = [];
            const memberInputs = document.querySelectorAll('.member-name');
            memberInputs.forEach(input => {
                if (input.value.trim()) {
                    memberNames.push(input.value.trim());
                }
            });
            
            if (memberNames.length === 0) {
                memberNames = ['Anna', 'Ben', 'Clara'];
            }

            // Auto-Profile erstellen
            memberProfiles = memberNames.map((name, index) => {
                const avatars = ['ğŸ˜Š', 'ğŸ˜', 'ğŸ¤“', 'ğŸ¥³', 'ğŸ˜‡', 'ğŸ¤”', 'ğŸ˜‹', 'ğŸ™ƒ', 'ğŸ¤ª', 'ğŸ˜Œ'];
                const icons = ['fas fa-user-circle', 'fas fa-star', 'fas fa-crown', 'fas fa-heart', 'fas fa-bolt'];
                const useIcon = Math.random() > 0.5;
                
                return {
                    name: name,
                    email: `${name.toLowerCase()}@auto-wg.de`,
                    avatar: useIcon ? 
                        `<i class="${icons[index % icons.length]}" style="font-size: 18px; color: #3b82f6;"></i>` : 
                        avatars[index % avatars.length]
                };
            });

            // Sicherstellen dass Tasks existieren
            if (!tasks || tasks.length === 0) {
                tasks = [
                    {title: 'KÃ¼che putzen', emoji: 'ğŸ§¹', description: 'SpÃ¼lmaschine ausrÃ¤umen, OberflÃ¤chen wischen'},
                    {title: 'Bad putzen', emoji: 'ğŸ›', description: 'Toilette, Dusche, Waschbecken reinigen'},
                    {title: 'MÃ¼ll rausbringen', emoji: 'ğŸ—‘ï¸', description: 'Alle MÃ¼lleimer leeren und neue Beutel einsetzen'},
                    {title: 'Staubsaugen', emoji: 'ğŸ§¹', description: 'Alle RÃ¤ume durchsaugen'},
                    {title: 'Pflanzen gieÃŸen', emoji: 'ğŸŒ±', description: 'Alle Zimmerpflanzen bewÃ¤ssern'}
                ];
            }

            // Auto-Ratings fÃ¼r alle Mitglieder und Tasks
            ratings = {};
            allRatings = {};
            memberProfiles.forEach(member => {
                ratings[member.name] = {};
                allRatings[member.name] = {};
                
                tasks.forEach(task => {
                    const rating = {
                        minutes: Math.floor(Math.random() * 50) + 10,
                        pain: Math.floor(Math.random() * 5) + 1,
                        importance: Math.floor(Math.random() * 5) + 1,
                        frequency: Math.floor(Math.random() * 4) + 1
                    };
                    
                    rating.points = Math.round((rating.minutes * 0.5) + (rating.pain * 2) + (rating.importance * 1.5));
                    
                    ratings[member.name][task.title] = rating;
                    allRatings[member.name][task.title] = rating;
                });
            });

            // Speichern
            saveCurrentState();
            
            showSuccessToast('âœ… Komplett-Setup abgeschlossen! Zum Dashboard...');
            
            // Direkt zum Dashboard
            setTimeout(() => {
                showDashboard();
            }, 2000);
            } catch (error) {
                console.error('âŒ Fehler in completeAutoSetup:', error);
                alert('âŒ Fehler beim Auto-Setup: ' + error.message);
            }
        }

        function selectEmoji(element, emoji) {
            const taskItem = element.closest('.task-item');
            taskItem.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            taskItem.dataset.emoji = emoji;
        }

        function selectIcon(element, iconClass, fallbackEmoji) {
            const taskItem = element.closest('.task-item');
            taskItem.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            // Store both icon and fallback emoji
            taskItem.dataset.icon = iconClass;
            taskItem.dataset.emoji = fallbackEmoji;
        }

        function updateMemberCount() {
            const count = parseInt(document.getElementById('memberCount').value);
            const container = document.getElementById('memberNames');
            
            container.innerHTML = '<h3 class="font-bold mb-4">Namen der WG-Mitglieder:</h3>';
            
            for (let i = 1; i <= count; i++) {
                const name = debugProfiles[i-1]?.name || ['Diana', 'Emil', 'Fiona'][i-4] || `Person${i}`;
                container.innerHTML += `
                    <div class="form-group">
                        <label>Person ${i}</label>
                        <input type="text" class="member-name" value="${name}" />
                    </div>
                `;
            }
            
            // Update memberNames array
            memberNames = [];
            for (let i = 0; i < count; i++) {
                memberNames.push(debugProfiles[i]?.name || `Person${i+1}`);
            }
        }

        function debugFillAndSkip(targetPhase) {
            if (targetPhase === 1) {
                // Skip WG setup
                wgName = 'Villa Kunterbunt';
                memberNames = ['Anna', 'Ben', 'Clara'];
                document.getElementById('wgNameDisplay').textContent = wgName;
                nextPhase(1);
            } else if (targetPhase === 2) {
                // Skip all profiles - fill with debug data and jump to tasks
                memberProfiles = [...debugProfiles];
                memberNames = debugProfiles.map(p => p.name);
                
                // Save profiles to localStorage
                localStorage.setItem('wgMembers', JSON.stringify(memberProfiles));
                localStorage.setItem('wgName', wgName || 'Villa Kunterbunt');
                
                // Update WG display if needed
                const wgDisplay = document.getElementById('wgNameDisplay');
                if (wgDisplay && !wgName) {
                    wgName = 'Villa Kunterbunt';
                    wgDisplay.textContent = wgName;
                }
                
                showSuccessToast('ğŸ› Alle Profile Ã¼bersprungen - direkt zu Tasks!');
                
                // Hide current phase and show phase 2 (tasks)
                document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
                document.getElementById('phase2').classList.remove('hidden');
            } else if (targetPhase === 3) {
                // Skip task creation
                tasks = [...debugTasks];
                document.getElementById('totalTasks').textContent = tasks.length;
                document.getElementById('totalMembers').textContent = memberProfiles.length;
                document.getElementById('ratingMemberName').textContent = memberProfiles[0].name;
                document.getElementById('currentRatingMember').textContent = 1;
                
                currentRatingMemberIndex = 0;
                currentTaskIndex = 0;
                allRatings = {};
                
                loadTask(0);
                nextPhase(3);
            }
        }

        function debugFillAllData() {
            // Fill WG data
            wgName = 'Villa Kunterbunt';
            memberNames = ['Anna', 'Ben', 'Clara'];
            
            // Fill member profiles
            memberProfiles = [...debugProfiles];
            
            // Fill tasks with checklists
            tasks = [...debugTasks];
            
            // Fill ratings
            allRatings = { ...debugRatings };
            
            // Save to localStorage
            localStorage.setItem('wgName', wgName);
            localStorage.setItem('wgMembers', JSON.stringify(memberNames.map((name, i) => ({
                name: name,
                avatar: debugProfiles[i]?.avatar || 'ğŸ˜Š',
                email: debugProfiles[i]?.email || `${name.toLowerCase()}@example.com`
            }))));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Save ratings to localStorage
            memberProfiles.forEach(member => {
                tasks.forEach(task => {
                    const key = `rating_${member.name}_${task.title}`;
                    const rating = debugRatings[member.name]?.[task.title];
                    if (rating) {
                        localStorage.setItem(key, JSON.stringify(rating));
                    }
                });
            });
            
            // Initialize task executions
            taskExecutions = {};
            memberProfiles.forEach(member => {
                taskExecutions[member.name] = {};
                tasks.forEach(task => {
                    taskExecutions[member.name][task.title] = [];
                });
            });
            
            showSuccessToast('ğŸ› Debug-Daten vollstÃ¤ndig geladen! Alle Tasks haben jetzt Checklisten.');
            showDashboard();
        }

        function debugAutoRate() {
            console.log('ğŸ”¥ debugAutoRate() aufgerufen!');
            console.log('memberProfiles:', memberProfiles);
            console.log('tasks:', tasks);
            try {
                // Auto-Rate fÃ¼r ALLE Profile und ALLE Tasks
                if (!memberProfiles || memberProfiles.length === 0) {
                    alert('âŒ Keine Profile vorhanden! Bitte zuerst Profile anlegen.');
                    return;
                }
                if (!tasks || tasks.length === 0) {
                    alert('âŒ Keine Tasks vorhanden! Bitte zuerst Tasks anlegen.');
                    return;
                }
                memberProfiles.forEach((member, memberIdx) => {
                tasks.forEach((task, taskIdx) => {
                    // Generiere zufÃ¤llige realistische Werte
                    const randomRating = {
                        minutes: Math.floor(Math.random() * 50) + 10, // 10-60 Minuten
                        pain: Math.floor(Math.random() * 5) + 1,      // 1-5 Schmerz
                        importance: Math.floor(Math.random() * 5) + 1, // 1-5 Wichtigkeit
                        frequency: Math.floor(Math.random() * 4) + 1   // 1-4 HÃ¤ufigkeit
                    };
                    
                    // Speichere Rating
                    if (!ratings[member.name]) ratings[member.name] = {};
                    if (!allRatings[member.name]) allRatings[member.name] = {};
                    
                    const ratingData = {
                        minutes: randomRating.minutes,
                        pain: randomRating.pain,
                        importance: randomRating.importance,
                        frequency: randomRating.frequency,
                        points: Math.round((randomRating.minutes * 0.5) + (randomRating.pain * 2) + (randomRating.importance * 1.5))
                    };
                    
                    ratings[member.name][task.title] = ratingData;
                    allRatings[member.name][task.title] = ratingData;
                });
            });
            
            // Speichern und direkt zum nÃ¤chsten Schritt
            saveCurrentState();
            showSuccessToast('ğŸ¯ Auto-Rate abgeschlossen! Alle Profile haben zufÃ¤llige Ratings erhalten.');
            
            // Direkt zu Phase 3 (Task-Setup) gehen - aber erst alle Ratings komplett abschlieÃŸen
            setTimeout(() => {
                // Alle Rating-Phasen als abgeschlossen markieren
                currentRatingMemberIndex = memberProfiles.length;
                currentTaskIndex = tasks.length;
                
                // Direkt zum Task-Setup
                nextPhase(3);
            }, 1500);
            } catch (error) {
                console.error('âŒ Fehler in debugAutoRate:', error);
                alert('âŒ Fehler beim Auto-Rate: ' + error.message);
            }
        }

        function addTask() {
            const taskList = document.getElementById('taskList');

            // Generate a unique task id for the newly created task elements
            const taskId = 'task_' + Date.now();

            const newTask = document.createElement('div');
            newTask.className = 'task-item';
            newTask.innerHTML = `
                <div class="form-group">
                    <label>Task Name</label>
                    <input type="text" placeholder="z.B. WÃ¤sche waschen" />
                </div>
                <div class="form-group">
                    <label>Beschreibung</label>
                    <input type="text" placeholder="WÃ¤sche sortieren, waschen, aufhÃ¤ngen..." />
                </div>
                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="checkbox" id="minDaysEnabled_${taskId}" onchange="toggleMinDays('${taskId}', this.checked)">
                        <label for="minDaysEnabled_${taskId}" style="margin: 0;">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                    </div>
                    <div id="minDaysSlider_${taskId}" style="margin-left: 24px; display: none;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span>Mindestens </span>
                            <input type="range" class="min-days-range" min="1" max="30" value="3" style="width: 150px;" oninput="updateMinDays('${taskId}', this.value)">
                            <span id="minDaysValue_${taskId}">3</span>
                            <span> Tage Pause</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <label style="margin: 0;">Icon wÃ¤hlen</label>
                        <button type="button" onclick="toggleIconSelector(this)" style="background: none; border: 1px solid #e5e7eb; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 12px;">ğŸ“‹ Mehr Icons</button>
                    </div>
                    
                    <!-- Quick Icons -->
                    <div class="emoji-grid" style="margin-bottom: 8px;">
                        <div class="emoji-option selected" onclick="selectIcon(this, 'fas fa-broom', 'ğŸ§¹')" data-icon="fas fa-broom"><i class="fas fa-broom"></i></div>
                        <div class="emoji-option" onclick="selectIcon(this, 'fas fa-utensils', 'ğŸ½ï¸')" data-icon="fas fa-utensils"><i class="fas fa-utensils"></i></div>
                        <div class="emoji-option" onclick="selectIcon(this, 'fas fa-shower', 'ğŸ›')" data-icon="fas fa-shower"><i class="fas fa-shower"></i></div>
                        <div class="emoji-option" onclick="selectIcon(this, 'fas fa-trash', 'ğŸ—‘ï¸')" data-icon="fas fa-trash"><i class="fas fa-trash"></i></div>
                        <div class="emoji-option" onclick="selectIcon(this, 'fas fa-tools', 'ğŸ”§')" data-icon="fas fa-tools"><i class="fas fa-tools"></i></div>
                        <div class="emoji-option" onclick="selectIcon(this, 'fas fa-seedling', 'ğŸŒ±')" data-icon="fas fa-seedling"><i class="fas fa-seedling"></i></div>
                    </div>
                    
                    <!-- Erweiterte Icon-Auswahl (versteckt) -->
                    <div class="extended-icon-selector" style="display: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #f8fafc;">
                        <div style="margin-bottom: 8px;"><h4 style="font-size: 12px; margin: 0; color: #374151;">ğŸ§¹ Putzen & Hygiene</h4></div>
                        <div class="emoji-grid">
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-soap', 'ğŸ§½')" data-icon="fas fa-soap"><i class="fas fa-soap"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-spray-can', 'ğŸ§´')" data-icon="fas fa-spray-can"><i class="fas fa-spray-can"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-toilet-paper', 'ğŸ§»')" data-icon="fas fa-toilet-paper"><i class="fas fa-toilet-paper"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-bath', 'ï¿½')" data-icon="fas fa-bath"><i class="fas fa-bath"></i></div>
                        </div>
                        <div style="margin: 8px 0;"><h4 style="font-size: 12px; margin: 0; color: #374151;">ğŸ½ï¸ KÃ¼che</h4></div>
                        <div class="emoji-grid">
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-coffee', 'â˜•')" data-icon="fas fa-coffee"><i class="fas fa-coffee"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-wine-glass', 'ï¿½')" data-icon="fas fa-wine-glass"><i class="fas fa-wine-glass"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-blender', 'ğŸ¥¤')" data-icon="fas fa-blender"><i class="fas fa-blender"></i></div>
                        </div>
                        <div style="margin: 8px 0;"><h4 style="font-size: 12px; margin: 0; color: #374151;">ğŸ  Haushalt</h4></div>
                        <div class="emoji-grid">
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-home', 'ğŸ ')" data-icon="fas fa-home"><i class="fas fa-home"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-box', 'ğŸ“¦')" data-icon="fas fa-box"><i class="fas fa-box"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-recycle', 'â™»ï¸')" data-icon="fas fa-recycle"><i class="fas fa-recycle"></i></div>
                            <div class="emoji-option" onclick="selectIcon(this, 'fas fa-couch', 'ğŸ›‹ï¸')" data-icon="fas fa-couch"><i class="fas fa-couch"></i></div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="this.closest('.task-item').remove()">Task entfernen</button>
            `;
            taskList.appendChild(newTask);
        }

        function toggleMinDays(taskId, enabled) {
            const slider = document.getElementById(`minDaysSlider_${taskId}`);
            if (slider) {
                if (enabled) {
                    slider.style.display = 'block';
                } else {
                    slider.style.display = 'none';
                }
            }
        }

        function updateMinDays(taskId, value) {
            const valueElement = document.getElementById(`minDaysValue_${taskId}`);
            if (valueElement) {
                valueElement.textContent = value;
            }
        }

        function updateDialMinDays(taskId, value) {
            // Update Kreisregler Visualisierung
            const progress = document.getElementById(`dialProgress_${taskId}`);
            const text = document.getElementById(`dialText_${taskId}`);
            const label = document.getElementById(`dialLabel_${taskId}`);
            
            if (progress && text && label) {
                // Berechne Kreisbogen (157 ist Umfang, 0-150 ist Range)
                const percentage = (value - 1) / 29; // 1-30 auf 0-1 normalisieren
                const offset = 157 - (157 * percentage);
                progress.style.strokeDashoffset = offset;
                
                // Update Text im Kreis
                text.textContent = value;
                
                // Update Label
                const dayText = value === '1' ? 'Tag' : 'Tage';
                label.textContent = `${value} ${dayText}`;
                
                // Farbwechsel basierend auf Wert
                const color = value <= 3 ? '#10b981' : value <= 7 ? '#3b82f6' : '#f59e0b';
                progress.style.stroke = color;
            }
        }

        function generateStrokeDisplay(count) {
            if (count === 0) return '';
            
            let result = '';
            let remaining = count;
            
            // Moderne Strich-Darstellung: nÃ¤her beieinander, letzter Strich quer durch alle
            while (remaining >= 5) {
                result += `
                    <span class="tally-group" style="
                        display: inline-block;
                        position: relative;
                        margin-right: 8px;
                        width: 24px;
                        height: 18px;
                    ">
                        <span style="
                            position: absolute;
                            left: 2px;
                            top: 0;
                            width: 2px;
                            height: 16px;
                            background: #374151;
                            border-radius: 1px;
                        "></span>
                        <span style="
                            position: absolute;
                            left: 6px;
                            top: 0;
                            width: 2px;
                            height: 16px;
                            background: #374151;
                            border-radius: 1px;
                        "></span>
                        <span style="
                            position: absolute;
                            left: 10px;
                            top: 0;
                            width: 2px;
                            height: 16px;
                            background: #374151;
                            border-radius: 1px;
                        "></span>
                        <span style="
                            position: absolute;
                            left: 14px;
                            top: 0;
                            width: 2px;
                            height: 16px;
                            background: #374151;
                            border-radius: 1px;
                        "></span>
                        <span style="
                            position: absolute;
                            left: 0;
                            top: 6px;
                            width: 20px;
                            height: 2px;
                            background: #dc2626;
                            border-radius: 1px;
                            transform: rotate(-25deg);
                            transform-origin: center;
                        "></span>
                    </span>
                `;
                remaining -= 5;
            }
            
            // Einzelne Striche (nÃ¤her beieinander)
            if (remaining > 0) {
                const width = remaining * 4;
                result += `<span style="display: inline-block; position: relative; width: ${width}px; height: 16px; margin-right: 4px;">`;
                for (let i = 0; i < remaining; i++) {
                    result += `
                        <span style="
                            position: absolute;
                            left: ${i * 4}px;
                            top: 0;
                            width: 2px;
                            height: 16px;
                            background: #374151;
                            border-radius: 1px;
                        "></span>
                    `;
                }
                result += `</span>`;
            }
            
            return result;
        }

        function nextPhase(phase) {
            if (phase === 1) {
                wgName = document.getElementById('wgName').value.trim();
                if (!wgName) {
                    alert('Bitte gib einen Namen fÃ¼r die WG ein!');
                    return;
                }
                
                memberNames = [];
                document.querySelectorAll('.member-name').forEach(input => {
                    if (input.value.trim()) {
                        memberNames.push(input.value.trim());
                    }
                });
                
                if (memberNames.length === 0) {
                    alert('Bitte gib mindestens einen Namen ein!');
                    return;
                }
                
                currentMemberIndex = 0;
                document.getElementById('currentMember').textContent = memberNames[0];
                document.getElementById('wgNameDisplay').textContent = wgName;
                
                // Debug: Setze erste Person mit Debug-Daten
                const debugProfile = debugProfiles[0];
                document.getElementById('userName').value = debugProfile.name;
                document.getElementById('userEmail').value = debugProfile.email;
            }

            if (phase === 2) {
                const userName = document.getElementById('userName').value.trim();
                if (!userName) {
                    alert('Bitte gib deinen Namen ein!');
                    return;
                }
                
                memberProfiles.push({
                    name: userName,
                    avatar: selectedAvatar,
                    email: document.getElementById('userEmail').value.trim()
                });
                
                currentMemberIndex++;
                if (currentMemberIndex < memberNames.length) {
                    const debugProfile = debugProfiles[currentMemberIndex];
                    document.getElementById('currentMember').textContent = memberNames[currentMemberIndex];
                    document.getElementById('userName').value = debugProfile.name;
                    document.getElementById('userEmail').value = debugProfile.email;
                    
                    const isLast = currentMemberIndex === memberNames.length - 1;
                    document.getElementById('profileButton').textContent = isLast ? 'Tasks erstellen â†’' : 'NÃ¤chste Person â†’';
                    
                    // Avatar auf Debug-Wert setzen
                    document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
                    document.querySelectorAll('.avatar-option').forEach(el => {
                        if (el.textContent === debugProfile.avatar) {
                            el.classList.add('selected');
                            selectedAvatar = debugProfile.avatar;
                        }
                    });
                    return;
                } else {
                    phase = 2; // Zu Task-Erstellung
                }
            }

            if (phase === '2_5') {
                // Tasks sammeln und zur BenutzerÃ¼bersicht
                tasks = [];
                document.querySelectorAll('.task-item').forEach((item, index) => {
                    const title = item.querySelector('input[placeholder*="z.B."]')?.value || item.querySelector('input[type="text"]')?.value || '';
                    const description = item.querySelector('input[placeholder*="..."]')?.value || item.querySelectorAll('input[type="text"]')[1]?.value || '';
                    const emoji = item.dataset.emoji || 'ğŸ§¹';
                    
                    // PrÃ¼fe neue Checkbox/Range-Logik
                    const checkbox = item.querySelector(`input[id*="minDaysEnabled"]`);
                    let minDays = 0;
                    if (checkbox && checkbox.checked) {
                        const range = item.querySelector('.min-days-range');
                        minDays = parseInt(range?.value) || 3;
                    }
                    
                    if (title.trim()) {
                        tasks.push({ 
                            title: title.trim(), 
                            description: description.trim(), 
                            emoji,
                            minDaysBetween: minDays
                        });
                    }
                });

                if (tasks.length === 0) {
                    alert('Bitte fÃ¼ge mindestens einen Task hinzu!');
                    return;
                }

                // Initialize ratings status
                userRatingsStatus = {};
                memberProfiles.forEach(profile => {
                    userRatingsStatus[profile.name] = false;
                });

                // Zeige BenutzerÃ¼bersicht
                buildUserOverview();
            }

            if (phase === 3) {
                // Start ratings for specific user or first user
                if (typeof currentRatingMemberIndex === 'undefined') {
                    currentRatingMemberIndex = 0;
                }
                currentTaskIndex = 0;
                if (!allRatings) allRatings = {};
                
                document.getElementById('totalTasks').textContent = tasks.length;
                document.getElementById('totalMembers').textContent = memberProfiles.length;
                document.getElementById('ratingMemberName').textContent = memberProfiles[0].name;
                document.getElementById('currentRatingMember').textContent = 1;
                
                loadTask(0);
            }

            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            document.getElementById(`phase${phase}`).classList.remove('hidden');
            
            // Update user overview if returning to it
            if (phase === '2_5') {
                buildUserOverview();
            }
        }

        function loadTask(index) {
            const task = tasks[index];
            document.getElementById('taskEmoji').textContent = task.emoji;
            document.getElementById('taskTitle').textContent = task.title;
            document.getElementById('taskDescription').textContent = task.description;
            document.getElementById('currentTask').textContent = index + 1;
            
            // Debug: Auto-fill mit realistischen Werten
            const memberName = memberProfiles[currentRatingMemberIndex].name;
            if (debugRatings[memberName] && debugRatings[memberName][task.title]) {
                const rating = debugRatings[memberName][task.title];
                document.querySelector('input[onchange*="minutesValue"]').value = rating.minutes;
                document.querySelector('input[onchange*="painValue"]').value = rating.pain;
                document.querySelector('input[onchange*="importanceValue"]').value = rating.importance;
                document.querySelector('input[onchange*="frequencyValue"]').value = rating.frequency;
                
                updateValue('minutesValue', rating.minutes);
                updateValue('painValue', rating.pain);
                updateValue('importanceValue', rating.importance);
                updateValue('frequencyValue', rating.frequency);
            } else {
                // Default values
                document.querySelectorAll('.slider').forEach(slider => {
                    slider.value = slider.defaultValue;
                    updateValue(slider.onchange.toString().match(/updateValue\('(\w+)'/)[1], slider.value);
                });
            }
            
            updateTaskPoints();
        }

        function updateValue(elementId, value) {
            document.getElementById(elementId).textContent = value;
            updateTaskPoints();
        }

        function updateTaskPoints() {
            const minutes = parseInt(document.getElementById('minutesValue').textContent);
            const pain = parseInt(document.getElementById('painValue').textContent);
            const importance = parseInt(document.getElementById('importanceValue').textContent);
            const frequency = parseInt(document.getElementById('frequencyValue').textContent);
            
            const points = Math.round((minutes + minutes * pain * 0.1) * (importance / 10));
            const monthlyPoints = points * frequency;
            
            document.getElementById('taskPoints').textContent = points;
            document.getElementById('monthlyPoints').textContent = monthlyPoints;
        }

        function previousTask() {
            if (currentTaskIndex > 0) {
                saveCurrentRating();
                currentTaskIndex--;
                loadTask(currentTaskIndex);
            }
        }

        function nextTask() {
            saveCurrentRating();
            
            if (currentTaskIndex < tasks.length - 1) {
                currentTaskIndex++;
                loadTask(currentTaskIndex);
            } else {
                // User finished rating all tasks, mark as completed and go back to overview
                const currentUser = memberProfiles[currentRatingMemberIndex].name;
                userRatingsStatus[currentUser] = true;
                
                // Go back to user overview
                nextPhase('2_5');
            }
        }

        function saveCurrentRating() {
            const memberName = memberProfiles[currentRatingMemberIndex].name;
            const taskTitle = tasks[currentTaskIndex].title;
            
            if (!allRatings[memberName]) {
                allRatings[memberName] = {};
            }
            
            allRatings[memberName][taskTitle] = {
                minutes: parseInt(document.getElementById('minutesValue').textContent),
                pain: parseInt(document.getElementById('painValue').textContent),
                importance: parseInt(document.getElementById('importanceValue').textContent),
                frequency: parseInt(document.getElementById('frequencyValue').textContent)
            };
        }

        // User Overview Functions
        let userRatingsStatus = {};

        function buildUserOverview() {
            const container = document.getElementById('userOverviewList');
            container.innerHTML = '';
            
            console.log('Building user overview. userRatingsStatus:', userRatingsStatus);
            console.log('memberProfiles:', memberProfiles);
            
            memberProfiles.forEach((profile, index) => {
                // Check if user has completed all tasks by checking allRatings
                const hasCompletedRatings = allRatings[profile.name] && 
                    Object.keys(allRatings[profile.name]).length === tasks.length;
                
                const isCompleted = userRatingsStatus[profile.name] || hasCompletedRatings;
                const statusIcon = isCompleted ? 'âœ…' : 'â³';
                const statusText = isCompleted ? 'Fertig bewertet' : 'Noch nicht bewertet';
                const buttonText = isCompleted ? 'Bewertungen Ã¤ndern' : 'Jetzt bewerten';
                
                console.log(`Profile ${profile.name}: completed=${isCompleted}, ratingsCount=${allRatings[profile.name] ? Object.keys(allRatings[profile.name]).length : 0}/${tasks.length}`);
                
                const userCard = document.createElement('div');
                userCard.className = `card ${isCompleted ? 'bg-green-50' : 'bg-gray-50'} mb-3`;
                userCard.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 32px;">${profile.avatar}</div>
                            <div>
                                <h3 class="font-bold">${profile.name}</h3>
                                <p class="text-gray-600">${profile.email || 'Keine E-Mail'}</p>
                                <p class="text-sm ${isCompleted ? 'text-green-600' : 'text-gray-500'}">${statusIcon} ${statusText}</p>
                            </div>
                        </div>
                        <button class="btn ${isCompleted ? 'btn-secondary' : 'btn-primary'}" onclick="startRatingFor(${index})">
                            ${buttonText}
                        </button>
                    </div>
                `;
                container.appendChild(userCard);
            });
            
            // Check if all users completed
            const allCompleted = memberProfiles.every(profile => userRatingsStatus[profile.name]);
            document.getElementById('startAllBtn').style.display = allCompleted ? 'block' : 'none';
        }

        function startRatingFor(memberIndex) {
            currentRatingMemberIndex = memberIndex;
            nextPhase(3);
        }

        function startAllRatings() {
            // Go to final completion phase
            showCompletion();
        }

        function debugFillAllRatings() {
            // Mark all as completed
            memberProfiles.forEach(profile => {
                userRatingsStatus[profile.name] = true;
                // Fill with debug ratings if available
                if (!allRatings[profile.name] && debugRatings[profile.name]) {
                    allRatings[profile.name] = debugRatings[profile.name];
                }
            });
            buildUserOverview();
        }

        // Dashboard Functions
        let taskExecutions = {}; // Store task executions per user
        
        function showCompletion() {
            showDashboard();
        }

        function showDashboard() {
            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            document.getElementById('phaseComplete').classList.remove('hidden');
            
            // Update dashboard stats
            document.getElementById('dashboardWgName').textContent = wgName;
            document.getElementById('totalTasksCount').textContent = tasks.length;
            
            // Initialize task executions if needed
            if (Object.keys(taskExecutions).length === 0) {
                memberProfiles.forEach(profile => {
                    taskExecutions[profile.name] = {};
                    tasks.forEach(task => {
                        taskExecutions[profile.name][task.title] = [];
                    });
                });
            }
        }

        function showTaskManagement() {
            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            document.getElementById('taskManagement').classList.remove('hidden');
            buildTaskManagementList();
        }

        function showTaskTable() {
            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            document.getElementById('taskTable').classList.remove('hidden');
            buildTaskTable();
        }

        function showMasterOverview() {
            // Hide all phases first
            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            
            // Show master overview
            document.getElementById('masterOverview').classList.remove('hidden');
            
            // Update master statistics
            updateMasterStatistics();
        }

        function updateMasterStatistics() {
            const wgName = localStorage.getItem('wgName') || 'Nicht konfiguriert';
            const members = JSON.parse(localStorage.getItem('wgMembers') || '[]');
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            
            // Count ratings
            let totalRatings = 0;
            members.forEach(member => {
                tasks.forEach(task => {
                    const rating = localStorage.getItem(`rating_${member.name}_${task.name}`);
                    if (rating) totalRatings++;
                });
            });
            
            // Update display
            document.getElementById('masterWgName').textContent = wgName;
            document.getElementById('masterMemberCount').textContent = members.length;
            document.getElementById('masterTaskCount').textContent = tasks.length;
            document.getElementById('masterRatingsCount').textContent = totalRatings;
        }

        // Navigation history for back button
        let navigationHistory = [];

        function showPhase(phaseId) {
            // Save current page to history
            const currentPhase = document.querySelector('.phase:not(.hidden)');
            if (currentPhase) {
                navigationHistory.push(currentPhase.id);
            }

            // Hide all phases
            document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
            
            // Show target phase
            document.getElementById(phaseId).classList.remove('hidden');
        }

        function goBack() {
            if (navigationHistory.length > 0) {
                const previousPhase = navigationHistory.pop();
                
                // Hide all phases
                document.querySelectorAll('.phase').forEach(el => el.classList.add('hidden'));
                
                // Show previous phase
                document.getElementById(previousPhase).classList.remove('hidden');
            } else {
                // Fallback to master overview
                showMasterOverview();
            }
        }

        function buildTaskManagementList() {
            const container = document.getElementById('taskManagementList');
            container.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const taskCard = document.createElement('div');
                taskCard.className = 'card mb-4';
                taskCard.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="font-size: 24px;">${task.emoji}</div>
                        <div style="flex: 1;">
                            <input type="text" value="${task.title}" class="task-edit-name" style="font-weight: bold; border: 1px solid #ddd; padding: 8px; border-radius: 6px; width: 100%;">
                        </div>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label>Beschreibung:</label>
                        <input type="text" value="${task.description}" class="task-edit-description" style="border: 1px solid #ddd; padding: 8px; border-radius: 6px; width: 100%;">
                    </div>
                    
                    <div class="form-group mb-3">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <input type="checkbox" id="taskMinDays_${index}" ${task.minDaysBetween > 0 ? 'checked' : ''} onchange="toggleTaskMinDays(${index}, this.checked)">
                            <label for="taskMinDays_${index}">â³ Mindestabstand zwischen AusfÃ¼hrungen</label>
                        </div>
                        <div id="taskMinDaysSlider_${index}" style="margin-left: 24px; ${task.minDaysBetween > 0 ? '' : 'display: none;'}">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>Mindestens </span>
                                <input type="range" min="1" max="30" value="${task.minDaysBetween || 1}" style="width: 150px;" oninput="updateTaskMinDays(${index}, this.value)">
                                <span id="taskMinDaysValue_${index}">${task.minDaysBetween || 1}</span>
                                <span> Tage Pause</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“‹ Checkliste fÃ¼r diesen Task:</label>
                        <div id="checklistItems_${index}" class="mt-2">
                            ${(task.checklist || []).map((item, itemIndex) => `
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <input type="text" value="${item}" class="checklist-item" style="flex: 1; border: 1px solid #ddd; padding: 6px; border-radius: 4px;">
                                    <button onclick="removeChecklistItem(${index}, ${itemIndex})" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;">Ã—</button>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="addChecklistItem(${index})" class="btn btn-secondary mt-2" style="font-size: 14px;">+ Punkt hinzufÃ¼gen</button>
                    </div>
                `;
                container.appendChild(taskCard);
            });
        }

        function buildTaskTable() {
            
            summary.innerHTML = `
                <div class="card mb-4" style="background: #fef3c7;">
                    <h3 class="font-bold mb-2">ğŸ  ${wgName}</h3>
                    <p>Mit ${memberProfiles.length} Mitgliedern: ${memberProfiles.map(p => p.name).join(', ')}</p>
                </div>
            ` + tasks.map(task => {
                const taskRatings = [];
                Object.keys(allRatings).forEach(memberName => {
                    if (allRatings[memberName][task.title]) {
                        taskRatings.push(allRatings[memberName][task.title]);
                    }
                });
                
                if (taskRatings.length === 0) return '';
                
                const avgMinutes = Math.round(taskRatings.reduce((sum, r) => sum + r.minutes, 0) / taskRatings.length);
                const avgPain = Math.round(taskRatings.reduce((sum, r) => sum + r.pain, 0) / taskRatings.length);
                const avgImportance = Math.round(taskRatings.reduce((sum, r) => sum + r.importance, 0) / taskRatings.length);
                const avgFrequency = Math.round(taskRatings.reduce((sum, r) => sum + r.frequency, 0) / taskRatings.length);
                
                const points = Math.round((avgMinutes + avgMinutes * avgPain * 0.1) * (avgImportance / 10));
                const monthlyPoints = points * avgFrequency;
                
                let minDaysText = '';
                if (task.minDaysBetween === 0) {
                    minDaysText = 'ğŸ”„ TÃ¤glich mÃ¶glich';
                } else if (task.minDaysBetween === 1) {
                    minDaysText = 'ğŸ”„ Min. 1 Tag Pause';
                } else if (task.minDaysBetween === 7) {
                    minDaysText = 'ğŸ”„ Min. 1 Woche Pause';
                } else if (task.minDaysBetween === 14) {
                    minDaysText = 'ğŸ”„ Min. 2 Wochen Pause';
                } else if (task.minDaysBetween === 30) {
                    minDaysText = 'ğŸ”„ Nur 1x/Monat';
                } else {
                    minDaysText = `ğŸ”„ Min. ${task.minDaysBetween} Tage Pause`;
                }
                
                return `
                    <div class="task-item">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span style="font-size: 24px; margin-right: 12px;">${task.emoji}</span>
                                <div>
                                    <strong>${task.title}</strong><br>
                                    <small class="text-gray-600">${task.description}</small><br>
                                    <small class="text-gray-600">â±ï¸ ${avgMinutes}min Â· ğŸ˜¤ ${avgPain}/10 Â· â­ ${avgImportance}/10 Â· ğŸ“… ${avgFrequency}x/Monat</small><br>
                                    <small class="text-gray-600">${minDaysText}</small>
                                </div>
                            </div>
                            <div class="text-right">
                                <div><strong>${points}</strong> Punkte</div>
                                <div class="text-sm text-gray-600">${monthlyPoints}/Monat</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function buildTaskTable() {
            const table = document.getElementById('taskTableGrid');
            
            // Header erstellen
            let headerHtml = '<thead><tr><th style="border: 1px solid #e5e7eb; padding: 16px 20px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); text-align: left; font-weight: 600; color: #334155; font-size: 14px;">Task</th>';
            memberProfiles.forEach(profile => {
                headerHtml += `<th style="border: 1px solid #e5e7eb; padding: 16px 20px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); text-align: center; font-weight: 600; color: #334155; font-size: 14px; min-width: 120px;">${profile.avatar} ${profile.name}</th>`;
            });
            headerHtml += '</tr></thead>';
            
            // Body erstellen
            let bodyHtml = '<tbody>';
            tasks.forEach((task, taskIndex) => {
                bodyHtml += `<tr style="transition: all 0.2s ease;">
                    <td style="border: 1px solid #e5e7eb; padding: 16px 20px; font-weight: 500; cursor: pointer; background: #ffffff; hover:background-color: #f8fafc;" onclick="selectTaskToExecute(\`${task.title}\`, ${taskIndex})" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='#ffffff'">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 18px;">${task.emoji}</span>
                            <span style="color: #334155; font-size: 15px;">${task.title}</span>
                        </div>
                    </td>`;
                
                memberProfiles.forEach(profile => {
                    const executions = taskExecutions[profile.name]?.[task.title] || [];
                    const executionCount = executions.length;
                    const strokesDisplay = generateStrokeDisplay(executionCount);
                    const totalPoints = executions.reduce((sum, exec) => sum + (exec.points || 0), 0);
                    
                    bodyHtml += `<td style="border: 1px solid #e5e7eb; padding: 16px 20px; text-align: center; font-family: 'SF Mono', Monaco, monospace; font-size: 16px; background: #ffffff; min-width: 120px;">
                        <div style="color: #1f2937; font-weight: 500;">${strokesDisplay || '-'}</div>
                        <div style="font-size: 11px; color: #64748b; font-family: system-ui; margin-top: 4px;">(${totalPoints}P)</div>
                    </td>`;
                });
                
                bodyHtml += '</tr>';
            });
            bodyHtml += '</tbody>';
            
            // Add totals row
            let totalsHtml = '<tfoot><tr><td style="border: 1px solid #e5e7eb; padding: 16px 20px; font-weight: 700; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); color: #475569; font-size: 14px;">GESAMT</td>';
            
            memberProfiles.forEach(profile => {
                // Calculate total points for this user
                let userTotalPoints = 0;
                let userTotalTasks = 0;
                
                Object.entries(taskExecutions[profile.name] || {}).forEach(([taskTitle, executions]) => {
                    userTotalPoints += executions.reduce((sum, exec) => sum + (exec.points || 0), 0);
                    userTotalTasks += executions.length;
                });
                
                // Calculate monthly target points (considering absences)
                const baseMonthlyTarget = calculateMonthlyTargetPoints();
                const absenceDays = getAbsenceDaysThisMonth(profile.name);
                const adjustedTarget = absenceDays > 0 ? calculateAdjustedTarget(baseMonthlyTarget, absenceDays) : baseMonthlyTarget;
                const percentage = adjustedTarget > 0 ? Math.round((userTotalPoints / adjustedTarget) * 100) : 0;
                
                const absenceIndicator = absenceDays > 0 ? ` ğŸ–ï¸` : '';
                const targetDisplay = absenceDays > 0 ? `${adjustedTarget}P (${baseMonthlyTarget}P-${absenceDays}d)` : `${adjustedTarget}P`;
                
                totalsHtml += `<td style="border: 1px solid #e5e7eb; padding: 16px 20px; text-align: center; font-weight: 600; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); min-width: 120px;">
                    <div style="font-size: 15px; color: #059669; font-weight: 700;">${userTotalPoints}P${absenceIndicator}</div>
                    <div style="font-size: 11px; color: #64748b; margin: 2px 0;">${userTotalPoints}/${targetDisplay} (${percentage}%)</div>
                    <div style="font-size: 10px; color: #94a3b8;">${userTotalTasks} Tasks</div>
                </td>`;
            });
            
            totalsHtml += '</tr></tfoot>';
            
            table.innerHTML = headerHtml + bodyHtml + totalsHtml;
        }

        // Modal-basierte Task-AusfÃ¼hrung
        let currentTaskData = null;
        let selectedUserIndex = null;

        function selectTaskToExecute(taskTitle, taskIndex) {
            currentTaskData = {
                task: tasks[taskIndex],
                taskIndex: taskIndex
            };
            
            showTaskExecutionModal();
        }

        function showTaskExecutionModal() {
            const modal = document.getElementById('taskExecutionModal');
            const task = currentTaskData.task;
            
            // Task Info aktualisieren
            document.getElementById('modalTaskEmoji').textContent = task.emoji;
            document.getElementById('modalTaskName').textContent = task.title;
            document.getElementById('modalTaskDescription').textContent = task.description || 'Keine Beschreibung verfÃ¼gbar';
            
            // User Grid erstellen
            const userGrid = document.getElementById('modalUserGrid');
            userGrid.innerHTML = memberProfiles.map((profile, index) => `
                <div class="user-card" data-user-index="${index}" onclick="selectUser(${index})">
                    <div class="user-avatar">${profile.avatar}</div>
                    <div class="user-name">${profile.name}</div>
                </div>
            `).join('');
            
            // Reset state
            selectedUserIndex = null;
            document.getElementById('userSelectionSection').style.display = 'block';
            document.getElementById('checklistSection').style.display = 'none';
            const executeBtn = document.getElementById('modalExecuteBtn');
            executeBtn.disabled = true;
            executeBtn.textContent = 'Task erledigt! âœ“';
            executeBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            // Clear user card selections
            document.querySelectorAll('.user-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Modal anzeigen
            modal.classList.add('show');
            
            // Event Listeners
            document.getElementById('modalCancelBtn').onclick = closeTaskModal;
            document.getElementById('modalExecuteBtn').onclick = executeTask;
        }

        function selectUser(userIndex) {
            selectedUserIndex = userIndex;
            
            // Visual feedback
            document.querySelectorAll('.user-card').forEach((card, index) => {
                if (index === userIndex) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            const task = currentTaskData.task;
            const user = memberProfiles[userIndex];
            
            // Checklist zeigen falls vorhanden mit Animation
            if (task.checklist && task.checklist.length > 0) {
                // User-Auswahl ausblenden
                document.getElementById('userSelectionSection').style.display = 'none';
                
                // Zeige BestÃ¤tigung
                showSuccessToast(`ğŸ‘¤ ${user.name} ausgewÃ¤hlt! Jetzt Checklist abarbeiten:`);
                
                // Checklist nach kurzer VerzÃ¶gerung anzeigen
                setTimeout(() => {
                    showChecklistSection();
                }, 300);
            } else {
                // Direkt ausfÃ¼hren ohne Checklist
                document.getElementById('userSelectionSection').style.display = 'none';
                showSuccessToast(`ğŸ‘¤ ${user.name} ausgewÃ¤hlt! Task kann erledigt werden:`);
                document.getElementById('modalExecuteBtn').disabled = false;
                
                // Button text anpassen
                document.getElementById('modalExecuteBtn').textContent = `âœ… Task fÃ¼r ${user.name} erledigen!`;
            }
        }

        function showChecklistSection() {
            const checklistSection = document.getElementById('checklistSection');
            checklistSection.style.display = 'block';
            
            const checklistContainer = document.getElementById('modalChecklist');
            const task = currentTaskData.task;
            const user = memberProfiles[selectedUserIndex];
            
            // Besserer Header fÃ¼r Checklist
            const checklistTitle = checklistSection.querySelector('h3');
            if (checklistTitle) {
                checklistTitle.innerHTML = `ğŸ“‹ ${user.name}, arbeite die Checklist ab:`;
            }
            
            checklistContainer.innerHTML = task.checklist.map((item, index) => `
                <div class="checklist-item">
                    <input type="checkbox" id="checkItem_${index}" onchange="updateExecuteButton()">
                    <label for="checkItem_${index}" style="margin: 0; cursor: pointer; flex: 1;">${item}</label>
                </div>
            `).join('');
            
            // Scroll to checklist
            setTimeout(() => {
                checklistSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
            
            updateExecuteButton();
        }

        function updateExecuteButton() {
            const checkboxes = document.querySelectorAll('#modalChecklist input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const executeBtn = document.getElementById('modalExecuteBtn');
            
            executeBtn.disabled = !allChecked;
            
            if (selectedUserIndex !== null) {
                const user = memberProfiles[selectedUserIndex];
                if (allChecked) {
                    executeBtn.textContent = `ğŸ‰ Task fÃ¼r ${user.name} erledigt!`;
                    executeBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                } else {
                    const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                    executeBtn.textContent = `ğŸ“‹ ${checkedCount}/${checkboxes.length} abgehakt`;
                    executeBtn.style.background = 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)';
                }
            }
        }

        function executeTask() {
            if (selectedUserIndex === null) return;
            
            const user = memberProfiles[selectedUserIndex];
            const task = currentTaskData.task;
            
            completeTaskExecution(task.title, user.name, currentTaskData.taskIndex);
            closeTaskModal();
        }

        function closeTaskModal() {
            document.getElementById('taskExecutionModal').classList.remove('show');
            currentTaskData = null;
            selectedUserIndex = null;
        }

        // Toast Notification System
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
                ${message}
            `;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after 2 seconds
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 2000);
        }

        // Checklist Management Functions
        function saveCurrentTaskValues() {
            // Speichere alle aktuellen Input-Werte bevor rebuild
            tasks.forEach((task, index) => {
                const titleInput = document.querySelector(`input[value="${task.title}"]`);
                if (titleInput) {
                    tasks[index].title = titleInput.value;
                }
                
                const descInput = titleInput?.parentElement?.nextElementSibling?.querySelector('input');
                if (descInput) {
                    tasks[index].description = descInput.value;
                }
                
                // Speichere Checklist-Werte
                const checklistItems = document.querySelectorAll(`#checklistItems_${index} .checklist-item`);
                if (checklistItems.length > 0) {
                    tasks[index].checklist = Array.from(checklistItems).map(item => item.value);
                }
            });
        }

        function addChecklistItem(taskIndex) {
            if (!tasks[taskIndex]) return;
            
            // Speichere aktuelle Werte
            saveCurrentTaskValues();
            
            if (!tasks[taskIndex].checklist) {
                tasks[taskIndex].checklist = [];
            }
            
            tasks[taskIndex].checklist.push('Neuer Checklistenpunkt');
            
            // Rebuild task management list to reflect changes
            buildTaskManagementList();
            showSuccessToast('Checklistenpunkt hinzugefÃ¼gt! ğŸ“‹');
        }

        function removeChecklistItem(taskIndex, itemIndex) {
            if (!tasks[taskIndex] || !tasks[taskIndex].checklist) return;
            
            // Speichere aktuelle Werte
            saveCurrentTaskValues();
            
            tasks[taskIndex].checklist.splice(itemIndex, 1);
            
            // Rebuild task management list to reflect changes
            buildTaskManagementList();
            showSuccessToast('Checklistenpunkt entfernt! ğŸ—‘ï¸');
        }



        function completeTaskExecution(taskTitle, userName, taskIndex) {
            if (!taskExecutions[userName]) taskExecutions[userName] = {};
            if (!taskExecutions[userName][taskTitle]) taskExecutions[userName][taskTitle] = [];
            
            // Calculate points for this task
            const taskPoints = calculateTaskPoints(taskTitle);
            
            taskExecutions[userName][taskTitle].push({
                date: new Date().toISOString(),
                timestamp: new Date().getTime(),
                points: taskPoints
            });
            
            // Update dashboard stats
            updateDashboardStats();
            
            showSuccessToast(`âœ… "${taskTitle}" erledigt! ${userName} erhÃ¤lt ${taskPoints} Punkte!`);
            buildTaskTable();
        }

        function calculateTaskPoints(param1, param2, param3, param4) {
            // Handle different calling patterns
            if (typeof param1 === 'string' && param2 === undefined) {
                // Called with taskTitle only - find task and calculate average
                const taskTitle = param1;
                const task = tasks.find(t => t.title === taskTitle);
                if (!task) return 10;
                
                const taskRatings = [];
                memberProfiles.forEach(profile => {
                    if (allRatings[profile.name] && allRatings[profile.name][taskTitle]) {
                        taskRatings.push(allRatings[profile.name][taskTitle]);
                    }
                });
                
                if (taskRatings.length === 0) return 10;
                
                const avgMinutes = taskRatings.reduce((sum, r) => sum + r.minutes, 0) / taskRatings.length;
                const avgPain = taskRatings.reduce((sum, r) => sum + r.pain, 0) / taskRatings.length;
                const avgImportance = taskRatings.reduce((sum, r) => sum + r.importance, 0) / taskRatings.length;
                
                return Math.round((avgMinutes * 0.5) + (avgPain * 2) + (avgImportance * 1.5));
            } else {
                // Called with individual rating values (minutes, pain, importance, frequency)
                const minutes = param1 || 0;
                const pain = param2 || 0;
                const importance = param3 || 0;
                const frequency = param4 || 0;
                
                return Math.round((minutes * 0.5) + (pain * 2) + (importance * 1.5));
            }
        }

        function updateDashboardStats() {
            const today = new Date().toDateString();
            let todayCount = 0;
            Object.values(taskExecutions).forEach(userTasks => {
                Object.values(userTasks).forEach(executions => {
                    todayCount += executions.filter(exec => new Date(exec.date).toDateString() === today).length;
                });
            });
            
            const todayElement = document.getElementById('completedTasksToday');
            if (todayElement) {
                todayElement.textContent = todayCount;
            }
        }

        function saveTaskChanges() {
            alert('âœ… Alle Ã„nderungen wurden gespeichert!');
            showDashboard();
        }

        function calculateMonthlyTargetPoints() {
            // Calculate total monthly points based on task ratings and frequencies
            let totalMonthlyPoints = 0;
            
            tasks.forEach(task => {
                const taskRatings = [];
                memberProfiles.forEach(profile => {
                    if (allRatings[profile.name] && allRatings[profile.name][task.title]) {
                        taskRatings.push(allRatings[profile.name][task.title]);
                    }
                });
                
                if (taskRatings.length > 0) {
                    const avgMinutes = taskRatings.reduce((sum, r) => sum + r.minutes, 0) / taskRatings.length;
                    const avgPain = taskRatings.reduce((sum, r) => sum + r.pain, 0) / taskRatings.length;
                    const avgImportance = taskRatings.reduce((sum, r) => sum + r.importance, 0) / taskRatings.length;
                    const avgFrequency = taskRatings.reduce((sum, r) => sum + r.frequency, 0) / taskRatings.length;
                    
                    const taskPoints = Math.round((avgMinutes * 0.5) + (avgPain * 2) + (avgImportance * 1.5));
                    const monthlyTaskPoints = Math.round(taskPoints * avgFrequency);
                    
                    totalMonthlyPoints += monthlyTaskPoints;
                }
            });
            
            // Distribute among all members
            return Math.round(totalMonthlyPoints / memberProfiles.length);
        }

        function addRandomTaskExecution() {
            const randomTask = tasks[Math.floor(Math.random() * tasks.length)];
            const randomUser = memberProfiles[Math.floor(Math.random() * memberProfiles.length)];
            const taskIndex = tasks.findIndex(t => t.title === randomTask.title);
            completeTaskExecution(randomTask.title, randomUser.name, taskIndex);
        }

        // Initialize first avatar selection
        selectAvatar(document.querySelector('.avatar-option'), 'ğŸ˜Š');

        // Absence Management System
        let absences = {}; // Structure: {userName: [{reason, startDate, endDate, days}]}
        let selectedAbsenceUser = null;

        // Profile Management System
        let wgProfiles = {}; // Structure: {profileId: {name, memberProfiles, tasks, ratings, absences, created, lastUsed}}
        let currentProfileId = null;

        function hideAllPhases() {
            console.log('ğŸ”„ Verstecke alle Phasen...');
            document.querySelectorAll('.phase').forEach(el => {
                el.classList.add('hidden');
                console.log('Hidden:', el.id);
            });
        }

        // Profile Management Functions
        function showProfileSelection() {
            console.log('ğŸ  Zeige Profil-Auswahl');
            hideAllPhases();
            document.getElementById('profileSelection').classList.remove('hidden');
            loadProfileList();
        }

        function loadProfileList() {
            const profileList = document.getElementById('profileList');
            const noProfilesMessage = document.getElementById('noProfilesMessage');
            
            const profileIds = Object.keys(wgProfiles);
            
            if (profileIds.length === 0) {
                profileList.innerHTML = '';
                noProfilesMessage.classList.remove('hidden');
                return;
            }
            
            noProfilesMessage.classList.add('hidden');
            
            let html = '';
            profileIds.forEach(profileId => {
                const profile = wgProfiles[profileId];
                const memberCount = profile.memberProfiles ? profile.memberProfiles.length : 0;
                const taskCount = profile.tasks ? profile.tasks.length : 0;
                const lastUsed = profile.lastUsed ? new Date(profile.lastUsed).toLocaleDateString('de-DE') : 'Nie verwendet';
                
                html += `
                    <div class="profile-card" onclick="loadProfile('${profileId}')">
                        <div class="profile-info">
                            <h3>${profile.name}</h3>
                            <div class="profile-stats">
                                <span><i class="fas fa-users"></i> ${memberCount} Mitglieder</span>
                                <span><i class="fas fa-tasks"></i> ${taskCount} Tasks</span>
                                <span><i class="fas fa-calendar"></i> ${lastUsed}</span>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn-load" onclick="event.stopPropagation(); loadProfile('${profileId}')" title="Profil laden">
                                <i class="fas fa-play"></i> Laden
                            </button>
                            <button class="btn-delete" onclick="event.stopPropagation(); confirmDeleteProfile('${profileId}')" title="Profil lÃ¶schen">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            profileList.innerHTML = html;
        }

        function createNewProfile() {
            console.log('â• Erstelle neues Profil');
            
            // Neues Profil initialisieren
            currentProfileId = 'profile_' + Date.now();
            
            // Default-Werte zurÃ¼cksetzen
            wgName = 'Meine WG';
            memberNames = [];
            memberProfiles = [];
            tasks = [];
            ratings = {};
            allRatings = {};
            absences = {};
            taskExecutions = {};
            
            // Setup-Workflow starten
            showPhase(0); // Phase 0: WG Setup
            showSuccessToast('ğŸ†• Neues WG-Profil wird erstellt');
        }

        function loadDariusWG() {
            console.log('ğŸš€ Lade vorkonfigurierte Darius WG');
            
            currentProfileId = 'darius_wg_' + Date.now();
            
            // Direkt die setupRealWG Funktion verwenden
            setupRealWG();
            
            // Als Profil speichern
            setTimeout(() => {
                saveCurrentProfile();
                showSuccessToast('ğŸ  Darius WG als Profil gespeichert!');
            }, 1000);
        }

        function loadProfile(profileId) {
            console.log('ğŸ“‚ Lade Profil:', profileId);
            
            const profile = wgProfiles[profileId];
            if (!profile) {
                alert('âŒ Profil nicht gefunden!');
                return;
            }
            
            try {
                currentProfileId = profileId;
                
                // Profil-Daten laden
                wgName = profile.name || 'Meine WG';
                memberProfiles = profile.memberProfiles || [];
                memberNames = memberProfiles.map(p => p.name);
                tasks = profile.tasks || [];
                ratings = profile.ratings || {};
                allRatings = profile.allRatings || {};
                absences = profile.absences || {};
                taskExecutions = profile.taskExecutions || {};
                
                // Task executions initialisieren falls leer
                if (Object.keys(taskExecutions).length === 0 && memberProfiles.length > 0) {
                    taskExecutions = {};
                    memberProfiles.forEach(member => {
                        taskExecutions[member.name] = {};
                        tasks.forEach(task => {
                            taskExecutions[member.name][task.title] = [];
                        });
                    });
                }
                
                // Last used aktualisieren
                wgProfiles[profileId].lastUsed = new Date().toISOString();
                saveProfilesToStorage();
                
                // Direkt zum Dashboard
                showDashboard();
                showSuccessToast(`âœ… Profil "${profile.name}" geladen!`);
                
            } catch (error) {
                console.error('âŒ Fehler beim Laden des Profils:', error);
                alert('âŒ Fehler beim Laden des Profils: ' + error.message);
            }
        }

        function confirmDeleteProfile(profileId) {
            const profile = wgProfiles[profileId];
            if (!profile) return;
            
            const confirmMessage = `âš ï¸ ACHTUNG: Profil lÃ¶schen?\n\nProfil: "${profile.name}"\nMitglieder: ${profile.memberProfiles?.length || 0}\nTasks: ${profile.tasks?.length || 0}\n\nDiese Aktion kann NICHT rÃ¼ckgÃ¤ngig gemacht werden!`;
            
            if (confirm(confirmMessage)) {
                const doubleConfirm = `ğŸš¨ LETZTE WARNUNG!\n\nProfile "${profile.name}" wird PERMANENT gelÃ¶scht!\n\nSind Sie ABSOLUT SICHER?`;
                
                if (confirm(doubleConfirm)) {
                    deleteProfile(profileId);
                }
            }
        }

        function deleteProfile(profileId) {
            console.log('ğŸ—‘ï¸ LÃ¶sche Profil:', profileId);
            
            const profileName = wgProfiles[profileId]?.name || 'Unbekannt';
            
            delete wgProfiles[profileId];
            saveProfilesToStorage();
            loadProfileList();
            
            showSuccessToast(`ğŸ—‘ï¸ Profil "${profileName}" wurde gelÃ¶scht`);
        }

        function saveCurrentProfile() {
            if (!currentProfileId) {
                console.warn('Kein aktuelles Profil zum Speichern');
                return;
            }
            
            console.log('ğŸ’¾ Speichere aktuelles Profil:', currentProfileId);
            
            wgProfiles[currentProfileId] = {
                name: wgName,
                memberProfiles: JSON.parse(JSON.stringify(memberProfiles)),
                tasks: JSON.parse(JSON.stringify(tasks)),
                ratings: JSON.parse(JSON.stringify(ratings)),
                allRatings: JSON.parse(JSON.stringify(allRatings)),
                absences: JSON.parse(JSON.stringify(absences)),
                taskExecutions: JSON.parse(JSON.stringify(taskExecutions)),
                created: wgProfiles[currentProfileId]?.created || new Date().toISOString(),
                lastUsed: new Date().toISOString()
            };
            
            saveProfilesToStorage();
            console.log('âœ… Profil gespeichert');
        }

        function saveProfilesToStorage() {
            try {
                localStorage.setItem('wgProfiles', JSON.stringify(wgProfiles));
                localStorage.setItem('currentProfileId', currentProfileId || '');
            } catch (error) {
                console.error('âŒ Fehler beim Speichern der Profile:', error);
            }
        }

        function loadProfilesFromStorage() {
            try {
                const savedProfiles = localStorage.getItem('wgProfiles');
                const savedCurrentId = localStorage.getItem('currentProfileId');
                
                if (savedProfiles && savedProfiles !== 'undefined') {
                    wgProfiles = JSON.parse(savedProfiles);
                    console.log('ğŸ“‚ Profile aus Storage geladen:', Object.keys(wgProfiles));
                }
                
                if (savedCurrentId && savedCurrentId !== 'undefined' && savedCurrentId !== '') {
                    currentProfileId = savedCurrentId;
                    console.log('ğŸ¯ Aktuelles Profil ID:', currentProfileId);
                }
            } catch (error) {
                console.error('âŒ Fehler beim Laden der Profile:', error);
                wgProfiles = {};
                currentProfileId = null;
            }
        }

        function clearAllProfiles() {
            if (confirm('ğŸš¨ ALLE WG-Profile lÃ¶schen?\n\nDies lÃ¶scht ALLE gespeicherten Profile permanent!\n\nSind Sie sicher?')) {
                if (confirm('âš ï¸ LETZTE WARNUNG!\n\nALLE Profile werden unwiderruflich gelÃ¶scht!\n\nFortfahren?')) {
                    wgProfiles = {};
                    currentProfileId = null;
                    localStorage.removeItem('wgProfiles');
                    localStorage.removeItem('currentProfileId');
                    localStorage.removeItem('absences');
                    localStorage.removeItem('ratings');
                    localStorage.removeItem('allRatings');
                    
                    loadProfileList();
                    showSuccessToast('ğŸ—‘ï¸ Alle Profile wurden gelÃ¶scht');
                }
            }
        }

        function exportProfiles() {
            const exportData = {
                profiles: wgProfiles,
                currentProfileId: currentProfileId,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const jsonData = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `putzplan-profile-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showSuccessToast('ğŸ“¤ Profile exportiert');
        }

        function showAbsenceManager() {
            console.log('ğŸ”¥ showAbsenceManager() aufgerufen!');
            console.log('memberProfiles:', memberProfiles);
            
            // PrÃ¼fen ob Profil-Daten vorhanden sind
            if (!memberProfiles || memberProfiles.length === 0) {
                console.log('âš ï¸ Keine Profile gefunden - verwende Debug-Profile');
                memberProfiles = debugProfiles;
            }
            
            try {
                hideAllPhases();
                document.getElementById('absenceManager').classList.remove('hidden');
                buildAbsenceUserGrid();
                displayAbsenceList();
            
            // Set default dates (today and tomorrow)
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('absenceStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('absenceEndDate').value = tomorrow.toISOString().split('T')[0];
            
            // Set up event listeners for date changes
            setTimeout(() => {
                const startDateInput = document.getElementById('absenceStartDate');
                const endDateInput = document.getElementById('absenceEndDate');
                
                if (startDateInput && endDateInput) {
                    startDateInput.addEventListener('change', updateAbsenceCalculation);
                    endDateInput.addEventListener('change', updateAbsenceCalculation);
                }
            }, 100);
            
            } catch (error) {
                console.error('âŒ Fehler in showAbsenceManager:', error);
                alert('âŒ Fehler beim Ã–ffnen der Abwesenheits-Verwaltung: ' + error.message);
            }
        }

        function buildAbsenceUserGrid() {
            const grid = document.getElementById('absenceUserGrid');
            grid.innerHTML = memberProfiles.map(profile => `
                <div class="absence-user-card" onclick="selectAbsenceUser('${profile.name}', this)">
                    <div style="font-size: 24px;">${profile.avatar}</div>
                    <div>
                        <div style="font-weight: 600;">${profile.name}</div>
                        <div style="font-size: 12px; color: #6b7280;">${getAbsenceDaysThisMonth(profile.name)} Tage diesen Monat</div>
                    </div>
                </div>
            `).join('');
        }

        function selectAbsenceUser(userName, element) {
            document.querySelectorAll('.absence-user-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedAbsenceUser = userName;
            
            document.getElementById('absenceDateSelection').classList.remove('hidden');
            updateAbsenceCalculation();
        }

        function updateAbsenceCalculation() {
            const startDate = document.getElementById('absenceStartDate').value;
            const endDate = document.getElementById('absenceEndDate').value;
            
            if (startDate && endDate && selectedAbsenceUser) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                if (days > 0) {
                    const monthlyTarget = calculateMonthlyTargetPoints();
                    const daysInMonth = new Date(start.getFullYear(), start.getMonth() + 1, 0).getDate();
                    const dailyTarget = monthlyTarget / daysInMonth;
                    const reductionPoints = Math.round(dailyTarget * days);
                    const newTarget = Math.max(0, monthlyTarget - reductionPoints);
                    
                    document.getElementById('absenceSummary').classList.remove('hidden');
                    document.getElementById('absenceImpact').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; font-size: 14px;">
                            <div><strong>${days}</strong> Tage abwesend</div>
                            <div><strong>-${reductionPoints}P</strong> Reduktion</div>
                            <div><strong>${newTarget}P</strong> neues Ziel</div>
                        </div>
                        <div style="font-size: 13px; color: #6b7280; margin-top: 8px;">
                            UrsprÃ¼ngliches Monatsziel: ${monthlyTarget}P â€¢ TÃ¤glicher Durchschnitt: ${Math.round(dailyTarget)}P
                        </div>
                    `;
                }
            }
        }

        function saveAbsence() {
            console.log('ğŸ”¥ saveAbsence() aufgerufen!');
            console.log('selectedAbsenceUser:', selectedAbsenceUser);
            try {
                const startDate = document.getElementById('absenceStartDate').value;
                const endDate = document.getElementById('absenceEndDate').value;
                const reason = document.getElementById('absenceReason').value;
            
            if (!selectedAbsenceUser || !startDate || !endDate) {
                alert('Bitte fÃ¼lle alle Felder aus!');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            if (days <= 0) {
                alert('Das End-Datum muss nach dem Start-Datum liegen!');
                return;
            }
            
            if (!absences[selectedAbsenceUser]) {
                absences[selectedAbsenceUser] = [];
            }
            
            // Bearbeitungsmodus prÃ¼fen
            if (editingAbsence) {
                console.log('âœï¸ Bearbeitungsmodus - Update existierende Abwesenheit');
                
                // ÃœberlappungsprÃ¼fung - aber aktuelle Abwesenheit ausschlieÃŸen
                const newStart = new Date(startDate);
                const newEnd = new Date(endDate);
                
                const overlapping = absences[selectedAbsenceUser].find((existing, idx) => {
                    // Aktuelle Abwesenheit ausschlieÃŸen
                    if (idx === editingAbsence.index) return false;
                    
                    const existingStart = new Date(existing.startDate);
                    const existingEnd = new Date(existing.endDate);
                    
                    return (newStart <= existingEnd && newEnd >= existingStart);
                });
                
                if (overlapping) {
                    const overlapStart = new Date(overlapping.startDate).toLocaleDateString('de-DE');
                    const overlapEnd = new Date(overlapping.endDate).toLocaleDateString('de-DE');
                    alert(`âŒ Zeitraum-Ãœberschneidung!\n\nDer neue Zeitraum Ã¼berschneidet sich mit:\n${overlapStart} - ${overlapEnd} (${overlapping.reason})\n\nBitte wÃ¤hle einen anderen Zeitraum.`);
                    return;
                }
                
                // Update existierende Abwesenheit
                absences[selectedAbsenceUser][editingAbsence.index] = {
                    reason: reason,
                    startDate: startDate,
                    endDate: endDate,
                    days: days,
                    created: absences[selectedAbsenceUser][editingAbsence.index].created, // Original-Datum behalten
                    updated: new Date().toISOString()
                };
                
                showSuccessToast(`âœ… Abwesenheit von ${selectedAbsenceUser} aktualisiert (${days} Tage)`);
                editingAbsence = null;
                
            } else {
                console.log('â• Neue Abwesenheit hinzufÃ¼gen');
                
                // PrÃ¼fung auf Ã¼berlappende ZeitrÃ¤ume fÃ¼r neue EintrÃ¤ge
                const newStart = new Date(startDate);
                const newEnd = new Date(endDate);
                
                const overlapping = absences[selectedAbsenceUser].find(existing => {
                    const existingStart = new Date(existing.startDate);
                    const existingEnd = new Date(existing.endDate);
                    
                    return (newStart <= existingEnd && newEnd >= existingStart);
                });
                
                if (overlapping) {
                    const overlapStart = new Date(overlapping.startDate).toLocaleDateString('de-DE');
                    const overlapEnd = new Date(overlapping.endDate).toLocaleDateString('de-DE');
                    alert(`âŒ Zeitraum-Ãœberschneidung!\n\nDer neue Zeitraum Ã¼berschneidet sich mit:\n${overlapStart} - ${overlapEnd} (${overlapping.reason})\n\nBitte wÃ¤hle einen anderen Zeitraum.`);
                    return;
                }
                
                // Neue Abwesenheit hinzufÃ¼gen
                absences[selectedAbsenceUser].push({
                    reason: reason,
                    startDate: startDate,
                    endDate: endDate,
                    days: days,
                    created: new Date().toISOString()
                });
                
                showSuccessToast(`âœ… Abwesenheit fÃ¼r ${selectedAbsenceUser} gespeichert (${days} Tage)`);
            }
            
            saveCurrentState();
            cancelAbsenceEntry();
            displayAbsenceList();
            buildAbsenceUserGrid();
            } catch (error) {
                console.error('âŒ Fehler in saveAbsence:', error);
                alert('âŒ Fehler beim Speichern der Abwesenheit: ' + error.message);
            }
        }

        function cancelAbsenceEntry() {
            selectedAbsenceUser = null;
            editingAbsence = null; // Edit-Modus zurÃ¼cksetzen
            
            document.getElementById('absenceDateSelection').classList.add('hidden');
            document.getElementById('absenceSummary').classList.add('hidden');
            document.querySelectorAll('.absence-user-card').forEach(el => el.classList.remove('selected'));
            
            // Button zurÃ¼cksetzen
            const saveButton = document.querySelector('button[onclick="saveAbsence()"]');
            if (saveButton) {
                saveButton.innerHTML = 'Abwesenheit speichern';
                saveButton.style.background = '';
            }
        }

        function displayAbsenceList() {
            const list = document.getElementById('absenceList');
            
            if (Object.keys(absences).length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 20px;">Noch keine Abwesenheiten eingetragen</div>';
                return;
            }
            
            let html = '';
            Object.entries(absences).forEach(([userName, userAbsences]) => {
                userAbsences.forEach((absence, index) => {
                    const reasonIcons = {
                        vacation: 'ğŸ–ï¸ Urlaub',
                        work: 'ğŸ’¼ GeschÃ¤ftsreise',
                        family: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familie'
                    };
                    
                    html += `
                        <div class="absence-entry ${absence.reason}">
                            <div>
                                <div style="font-weight: 600;">${userName} â€¢ ${reasonIcons[absence.reason] || 'â“ Unbekannt'}</div>
                                <div style="font-size: 13px; color: #6b7280;">
                                    ${formatDate(absence.startDate)} - ${formatDate(absence.endDate)} 
                                    (${absence.days} Tage)
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editAbsence(&quot;${userName}&quot;, ${index})" style="background: none; border: none; color: #3b82f6; cursor: pointer; padding: 4px;" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteAbsence(&quot;${userName}&quot;, ${index})" style="background: none; border: none; color: #ef4444; cursor: pointer; padding: 4px;" title="LÃ¶schen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
            });
            
            list.innerHTML = html;
        }

        function deleteAbsence(userName, index) {
            console.log('ğŸ—‘ï¸ deleteAbsence aufgerufen:', userName, index);
            try {
                if (confirm(`Abwesenheit von ${userName} wirklich lÃ¶schen?`)) {
                    if (absences[userName] && absences[userName][index]) {
                        absences[userName].splice(index, 1);
                        if (absences[userName].length === 0) {
                            delete absences[userName];
                        }
                        saveCurrentState();
                        displayAbsenceList();
                        buildAbsenceUserGrid();
                        showSuccessToast('Abwesenheit gelÃ¶scht');
                    } else {
                        alert('âŒ Abwesenheit nicht gefunden!');
                    }
                }
            } catch (error) {
                console.error('âŒ Fehler beim LÃ¶schen:', error);
                alert('âŒ Fehler beim LÃ¶schen der Abwesenheit: ' + error.message);
            }
        }

        let editingAbsence = null;

        function editAbsence(userName, index) {
            console.log('âœï¸ editAbsence aufgerufen:', userName, index);
            try {
                if (!absences[userName] || !absences[userName][index]) {
                    alert('âŒ Abwesenheit nicht gefunden!');
                    return;
                }

                const absence = absences[userName][index];
                editingAbsence = { userName, index };

                // User auswÃ¤hlen
                selectAbsenceUser(userName, document.querySelector(`.absence-user-card[onclick*="${userName}"]`));

                // Daten in Formular laden
                document.getElementById('absenceStartDate').value = absence.startDate;
                document.getElementById('absenceEndDate').value = absence.endDate;
                document.getElementById('absenceReason').value = absence.reason;

                // Update calculation
                updateAbsenceCalculation();

                // Button Text Ã¤ndern
                const saveButton = document.querySelector('button[onclick="saveAbsence()"]');
                if (saveButton) {
                    saveButton.innerHTML = 'Ã„nderungen speichern';
                    saveButton.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                }

                showSuccessToast(`âœï¸ Bearbeite Abwesenheit von ${userName}`);
            } catch (error) {
                console.error('âŒ Fehler beim Bearbeiten:', error);
                alert('âŒ Fehler beim Bearbeiten der Abwesenheit: ' + error.message);
            }
        }

        function getAbsenceDaysThisMonth(userName) {
            if (!absences[userName]) return 0;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            return absences[userName].reduce((total, absence) => {
                const start = new Date(absence.startDate);
                const end = new Date(absence.endDate);
                
                if ((start.getFullYear() === currentYear && start.getMonth() === currentMonth) ||
                    (end.getFullYear() === currentYear && end.getMonth() === currentMonth)) {
                    return total + absence.days;
                }
                return total;
            }, 0);
        }

        function addDemoAbsences() {
            absences = {
                'Anna': [{
                    reason: 'vacation',
                    startDate: '2024-09-15',
                    endDate: '2024-09-22',
                    days: 8,
                    created: new Date().toISOString()
                }],
                'Ben': [{
                    reason: 'sick', 
                    startDate: '2024-09-10',
                    endDate: '2024-09-12',
                    days: 3,
                    created: new Date().toISOString()
                }]
            };
            
            saveCurrentState();
            displayAbsenceList();
            buildAbsenceUserGrid();
            showSuccessToast('ğŸ› Demo-Abwesenheiten hinzugefÃ¼gt');
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function cleanupDuplicateAbsences() {
            console.log('ğŸ§¹ Bereinige doppelte Abwesenheits-EintrÃ¤ge...');
            let removedCount = 0;
            
            Object.keys(absences).forEach(userName => {
                const userAbsences = absences[userName];
                const unique = [];
                
                userAbsences.forEach(absence => {
                    const isDuplicate = unique.some(existing => 
                        existing.startDate === absence.startDate &&
                        existing.endDate === absence.endDate &&
                        existing.reason === absence.reason
                    );
                    
                    if (!isDuplicate) {
                        unique.push(absence);
                    } else {
                        removedCount++;
                        console.log(`Entfernt: ${userName} - ${absence.startDate} bis ${absence.endDate}`);
                    }
                });
                
                absences[userName] = unique;
            });
            
            if (removedCount > 0) {
                saveCurrentState();
                displayAbsenceList();
                buildAbsenceUserGrid();
                showSuccessToast(`ğŸ§¹ ${removedCount} doppelte EintrÃ¤ge entfernt`);
                console.log(`âœ… ${removedCount} doppelte Abwesenheits-EintrÃ¤ge entfernt`);
            } else {
                showSuccessToast('âœ… Keine doppelten EintrÃ¤ge gefunden');
            }
        }

        function calculateAdjustedTarget(baseTarget, absenceDays) {
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const dailyTarget = baseTarget / daysInMonth;
            const reduction = Math.round(dailyTarget * absenceDays);
            return Math.max(0, baseTarget - reduction);
        }

        function saveCurrentState() {
            // Save all current state to localStorage
            try {
                if (wgName) localStorage.setItem('wgName', wgName);
                if (memberProfiles && memberProfiles.length > 0) {
                    localStorage.setItem('wgMembers', JSON.stringify(memberProfiles));
                }
                if (tasks && tasks.length > 0) {
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                }
                if (Object.keys(ratings).length > 0) {
                    localStorage.setItem('ratings', JSON.stringify(ratings));
                }
                if (Object.keys(allRatings).length > 0) {
                    localStorage.setItem('allRatings', JSON.stringify(allRatings));
                }
                
                // Aktuelles Profil speichern (neue Funktion)
                if (currentProfileId) {
                    saveCurrentProfile();
                }
                if (Object.keys(taskExecutions).length > 0) {
                    localStorage.setItem('taskExecutions', JSON.stringify(taskExecutions));
                }
                if (Object.keys(absences).length > 0) {
                    localStorage.setItem('absences', JSON.stringify(absences));
                }
            } catch(e) {
                console.error('Fehler beim Speichern:', e);
            }
        }

        // Event listeners werden in showAbsenceManager() gesetzt
        
        // Load data from localStorage if available  
        try {
            const savedAbsences = localStorage.getItem('absences');
            if (savedAbsences && savedAbsences !== 'undefined') {
                absences = JSON.parse(savedAbsences);
                
                // Automatische Bereinigung bei Laden der Daten
                setTimeout(() => {
                    cleanupDuplicateAbsences();
                }, 1000);
            }
            
            const savedRatings = localStorage.getItem('ratings');
            if (savedRatings && savedRatings !== 'undefined') {
                ratings = JSON.parse(savedRatings);
            }
            
            const savedAllRatings = localStorage.getItem('allRatings');
            if (savedAllRatings && savedAllRatings !== 'undefined') {
                allRatings = JSON.parse(savedAllRatings);
            }
        } catch(e) {
            console.log('Keine gespeicherten Daten gefunden oder Fehler beim Laden');
        }

        // Sofort starten statt setTimeout verwenden
        console.log('ğŸš€ App wird gestartet...');
        try {
            // Profile Management System initialisieren
            loadProfilesFromStorage();
            
            // Direkt starten
            showProfileSelection();
            console.log('âœ… App erfolgreich gestartet');
        } catch (error) {
            console.error('âŒ FEHLER beim App-Start:', error);
            alert('JavaScript Fehler: ' + error.message);
        }

        // Test ob JavaScript funktioniert
        console.log('ğŸ”¥ JavaScript geladen - Version:', new Date().toISOString());

        // Funktionen global verfÃ¼gbar machen
        window.showProfileSelection = showProfileSelection;
        window.createNewProfile = createNewProfile;
        window.loadDariusWG = loadDariusWG;
        window.loadProfile = loadProfile;
        window.confirmDeleteProfile = confirmDeleteProfile;
        window.clearAllProfiles = clearAllProfiles;
        window.exportProfiles = exportProfiles;
        window.showMasterOverview = showMasterOverview;
        window.setupRealWG = setupRealWG;
        window.completeAutoSetup = completeAutoSetup;

        // Weitere wichtige Funktionen global machen
        window.showDashboard = showDashboard;
        window.showAbsenceManager = showAbsenceManager;
        window.saveAbsence = saveAbsence;
        window.editAbsence = editAbsence;
        window.deleteAbsence = deleteAbsence;
        window.cleanupDuplicateAbsences = cleanupDuplicateAbsences;
        window.showTaskManagement = showTaskManagement;
        window.nextPhase = nextPhase;
        window.debugFillAndSkip = debugFillAndSkip;

        console.log('ğŸŒ Alle Funktionen global verfÃ¼gbar gemacht');
        
        // Global error handler
        window.onerror = function(msg, url, line, col, error) {
            console.error('ğŸš¨ JavaScript Fehler:', {
                message: msg,
                source: url,
                line: line,
                column: col,
                error: error
            });
            alert('JavaScript Fehler in Zeile ' + line + ': ' + msg);
        };
    </script>
    </div> <!-- End app-container -->
</body>
</html>