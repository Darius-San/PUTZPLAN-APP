<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Putzplan App - Reparierte Version</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: #ffffff;
            position: relative;
        }

        /* Phases */
        .phase { display: none; }
        .phase.active { display: block; }

        /* Header */
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        /* Content */
        .content {
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            width: 100%;
            margin: 8px 0;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; }
        .btn-debug { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }

        .space-y-3 > * + * { margin-top: 12px; }
        .w-full { width: 100%; }

        /* Dashboard specific */
        .member-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 8px 0;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin: 8px 0;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show { transform: translateX(0); }

        /* Interactive Task Items */
        .interactive-task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            margin: 12px 0;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .interactive-task:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .interactive-task.completed {
            background: #dcfce7;
            border-color: #10b981;
        }

        .task-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .task-emoji {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .task-details h4 {
            margin: 0 0 4px 0;
            font-weight: 600;
            color: #1f2937;
        }

        .task-details p {
            margin: 0;
            font-size: 14px;
            color: #6b7280;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .task-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .task-btn-complete {
            background: #10b981;
            color: white;
        }

        .task-btn-complete:hover {
            background: #059669;
        }

        .task-btn-edit {
            background: #f59e0b;
            color: white;
        }

        .task-btn-edit:hover {
            background: #d97706;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Form Input Styles */
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Table Styles */
        #taskTableGrid th {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #taskTableGrid tr:hover {
            background-color: #f9fafb;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        @media (max-width: 580px) {
            .content { padding: 16px; }
            .card { padding: 16px; margin-bottom: 16px; }
            .task-actions { flex-direction: column; gap: 4px; }
            .modal-content { margin: 20px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Profile Selection Phase -->
        <div id="profileSelection" class="phase active">
            <div class="header">
                <h1><i class="fas fa-home"></i> WG Home</h1>
                <p>W√§hle oder erstelle eine WG</p>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2 style="margin-bottom: 16px; color: #1f2937;">
                        <i class="fas fa-users" style="color: #3b82f6;"></i>
                        WG Profile
                    </h2>
                    <div class="space-y-3">
                        <button class="btn btn-success w-full" onclick="createNewProfile()">
                            <i class="fas fa-plus"></i>
                            Neue WG erstellen
                        </button>
                        <button class="btn btn-primary w-full" onclick="loadWerthiWG()">
                            <i class="fas fa-rocket"></i>
                            Werthi WG (Vorkonfiguriert)
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 12px;">Debug Actions</h3>
                    <button class="btn btn-debug" onclick="clearAllProfiles()">üóëÔ∏è Alle Profile l√∂schen</button>
                    <button class="btn btn-debug" onclick="testFunction()">üîß Test Function</button>
                </div>
            </div>
        </div>

        <!-- Setup Phase 0 -->
        <div id="phase0" class="phase">
            <div class="header">
                <h1><i class="fas fa-cog"></i> WG Setup</h1>
                <p>Schritt 1: WG Name</p>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2 style="margin-bottom: 16px;">WG Name eingeben</h2>
                    <input type="text" id="wgNameInput" placeholder="z.B. Werthi WG" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 16px;">
                    
                    <button class="btn btn-primary" onclick="nextPhase(1)">Weiter zu Profilen ‚Üí</button>
                    <button class="btn btn-secondary" onclick="goBack()">‚Üê Zur√ºck</button>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="phase">
            <div class="content">
                <div class="card gradient-bg">
                    <h1 style="font-weight: bold; font-size: 24px; margin-bottom: 8px;">üè† WG Dashboard</h1>
                    <p><strong id="dashboardWGName">Villa Kunterbunt</strong> - Putzplan App</p>
                    <div style="margin-top: 12px;">
                        <button class="btn btn-secondary" onclick="showPhase('profileSelection')" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 14px; padding: 8px 16px;">
                            <i class="fas fa-exchange-alt" style="margin-right: 4px;"></i>
                            Profil wechseln
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-weight: bold; margin-bottom: 16px;">üìä Schnell√ºbersicht</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                        <div style="padding: 16px; background: #eff6ff; border-radius: 8px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold;" id="totalTasksCount">0</div>
                                <div style="font-size: 14px; color: #6b7280;">Tasks aktiv</div>
                            </div>
                        </div>
                        <div style="padding: 16px; background: #f0fdf4; border-radius: 8px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold;" id="completedTasksToday">0</div>
                                <div style="font-size: 14px; color: #6b7280;">Heute erledigt</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="font-weight: bold; margin-bottom: 16px;">üß≠ Navigation</h3>
                    <div style="display: grid; gap: 12px;">
                        <button class="btn btn-primary" onclick="showTaskTable()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-table" style="width: 20px;"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold;">Tabellen-√úbersicht</div>
                                    <div style="font-size: 14px; opacity: 0.8;">Tasks erledigen und verfolgen</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <button class="btn btn-secondary" onclick="showTaskManagement()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-cog" style="width: 20px;"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold;">Tasks bearbeiten</div>
                                    <div style="font-size: 14px; opacity: 0.8;">Namen √§ndern, Pausen einstellen, Checklisten</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <button class="btn btn-secondary" onclick="showSetupSummary()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-chart-bar" style="width: 20px;"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold;">Setup-√úbersicht</div>
                                    <div style="font-size: 14px; opacity: 0.8;">Bewertungen und Statistiken ansehen</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <button class="btn btn-warning" onclick="showAbsenceManager()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-calendar-times" style="width: 20px; color: white;"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; color: white;">Abwesenheit melden</div>
                                    <div style="font-size: 14px; opacity: 0.9; color: white;">Urlaub/Gesch√§ftsreise eintragen</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: white;"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Table Page -->
        <div id="taskTable" class="phase hidden">
            <div class="content">
                <div class="card gradient-bg">
                    <h1 style="font-weight: bold; font-size: 24px; margin-bottom: 8px;">üìã Task-Tabelle</h1>
                    <p>Klicke auf einen Task-Namen um ihn zu erledigen</p>
                </div>

                <div class="card">
                    <div style="overflow-x: auto; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        <table id="taskTableGrid" style="width: 100%; border-collapse: collapse; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <!-- Wird dynamisch gef√ºllt -->
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                        <button class="btn btn-secondary" onclick="showPhase('dashboard')">‚Üê Zur√ºck</button>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-success" onclick="addRandomTaskExecution()">üéØ Random Task</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Management Page -->
        <div id="taskManagement" class="phase hidden">
            <div class="content">
                <div class="card gradient-bg">
                    <h1 style="font-weight: bold; font-size: 24px; margin-bottom: 8px;">‚öôÔ∏è Tasks bearbeiten</h1>
                    <p>Namen √§ndern, Mindestabst√§nde anpassen und Checklisten erstellen</p>
                </div>

                <div class="card">
                    <div id="taskManagementList">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                        <button class="btn btn-secondary" onclick="showPhase('dashboard')">‚Üê Zur√ºck</button>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="saveTaskChanges()">√Ñnderungen speichern</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Setup Summary Page -->
        <div id="setupSummary" class="phase hidden">
            <div class="content">
                <div class="card gradient-bg">
                    <h1 style="font-weight: bold; font-size: 24px; margin-bottom: 8px;">üìä Setup-√úbersicht</h1>
                    <p>Bewertungen und Statistiken ansehen</p>
                </div>

                <div class="card">
                    <h3 style="font-weight: bold; margin-bottom: 16px;">üë• Mitglieder</h3>
                    <div id="setupMembersList">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-weight: bold; margin-bottom: 16px;">üìã Tasks</h3>
                    <div id="setupTasksList">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-weight: bold; margin-bottom: 16px;">üìà Statistiken</h3>
                    <div id="setupStatistics">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="showPhase('dashboard')">‚Üê Zur√ºck</button>
                </div>
            </div>
        </div>

        <!-- Absence Manager Page -->
        <div id="absenceManager" class="phase hidden">
            <div class="content">
                <div class="card gradient-bg">
                    <h1 style="font-weight: bold; font-size: 24px; margin-bottom: 8px;">üèñÔ∏è Abwesenheit melden</h1>
                    <p>Trage deine Abwesenheitszeiten ein f√ºr faire Punkteverteilung</p>
                </div>

                <!-- User Selection -->
                <div class="card" id="absenceUserSelection">
                    <h3 style="font-weight: bold; margin-bottom: 12px;">üë§ Wer war/ist abwesend?</h3>
                    <div id="absenceUserGrid">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Date Selection -->
                <div class="card hidden" id="absenceDateSelection">
                    <h3 style="font-weight: bold; margin-bottom: 12px;">üìÖ Abwesenheitszeitraum</h3>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Grund der Abwesenheit</label>
                        <select id="absenceReason" class="form-input">
                            <option value="vacation">üèñÔ∏è Urlaub</option>
                            <option value="sick">ü§í Krank</option>
                            <option value="work">üíº Gesch√§ftsreise</option>
                            <option value="family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie/Besuch</option>
                            <option value="other">‚ùì Sonstiges</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 8px; display: block;">Von Datum</label>
                            <input type="date" id="absenceStartDate" class="form-input">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 8px; display: block;">Bis Datum</label>
                            <input type="date" id="absenceEndDate" class="form-input">
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="cancelAbsenceEntry()">Abbrechen</button>
                        <button class="btn btn-primary" onclick="saveAbsence()">Abwesenheit speichern</button>
                    </div>
                </div>

                <!-- Absence Overview -->
                <div class="card">
                    <h3 style="font-weight: bold; margin-bottom: 12px;">üìã Aktuelle Abwesenheiten</h3>
                    <div id="absenceList">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="showPhase('dashboard')">‚Üê Zur√ºck zum Dashboard</button>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-success" onclick="addDemoAbsences()">üéØ Demo-Abwesenheiten</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Complete Modal -->
    <div id="completeTaskModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 16px;">
                <i class="fas fa-check-circle" style="color: #10b981;"></i>
                Task abschlie√üen
            </h2>
            <div id="completeTaskInfo"></div>
            <div class="form-group">
                <label>Notizen (optional):</label>
                <textarea id="taskNotes" placeholder="Besondere Vorkommnisse, Probleme oder Anmerkungen..."></textarea>
            </div>
            <div class="form-group">
                <label>Wie lange hat es gedauert?</label>
                <select id="taskDuration">
                    <option value="5">5 Minuten</option>
                    <option value="10">10 Minuten</option>
                    <option value="15" selected>15 Minuten</option>
                    <option value="20">20 Minuten</option>
                    <option value="30">30 Minuten</option>
                    <option value="45">45 Minuten</option>
                    <option value="60">1 Stunde</option>
                    <option value="90">1,5 Stunden</option>
                    <option value="120">2 Stunden</option>
                </select>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-success" onclick="confirmCompleteTask()" style="flex: 1;">
                    <i class="fas fa-check"></i>
                    Abschlie√üen
                </button>
                <button class="btn btn-secondary" onclick="closeModal('completeTaskModal')" style="flex: 1;">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 16px;">
                <i class="fas fa-plus" style="color: #3b82f6;"></i>
                Neue Aufgabe hinzuf√ºgen
            </h2>
            <div class="form-group">
                <label>Task-Name:</label>
                <input type="text" id="newTaskTitle" placeholder="z.B. K√ºche putzen">
            </div>
            <div class="form-group">
                <label>Beschreibung:</label>
                <textarea id="newTaskDescription" placeholder="Detaillierte Beschreibung der Aufgabe..."></textarea>
            </div>
            <div class="form-group">
                <label>Emoji:</label>
                <input type="text" id="newTaskEmoji" placeholder="üßπ" maxlength="2">
            </div>
            <div class="form-group">
                <label>Kategorie:</label>
                <select id="newTaskCategory">
                    <option value="K√ºche">K√ºche</option>
                    <option value="Bad">Bad</option>
                    <option value="Wohnzimmer">Wohnzimmer</option>
                    <option value="M√ºll">M√ºll</option>
                    <option value="W√§sche">W√§sche</option>
                    <option value="Einkauf">Einkauf</option>
                    <option value="Reparatur">Reparatur</option>
                    <option value="Sonstige">Sonstige</option>
                </select>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-success" onclick="createNewTask()" style="flex: 1;">
                    <i class="fas fa-plus"></i>
                    Hinzuf√ºgen
                </button>
                <button class="btn btn-secondary" onclick="closeModal('addTaskModal')" style="flex: 1;">
                    <i class="fas fa-times"></i>
                    Abbrechen
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <script>
        console.log('üöÄ Reparierte App startet...');

        // === GLOBALE VARIABLEN ===
        let wgProfiles = {};
        let currentProfileId = null;
        let wgName = '';
        let memberProfiles = [];
        let tasks = [];
        let taskExecutions = [];
        let selectedTaskForCompletion = null;

        // === UI FUNKTIONEN ===
        function showPhase(phaseId) {
            console.log('üì± Zeige Phase:', phaseId);
            
            const phases = document.querySelectorAll('.phase');
            phases.forEach(phase => phase.classList.remove('active'));
            
            const targetPhase = document.getElementById(phaseId);
            if (targetPhase) {
                targetPhase.classList.add('active');
                console.log('‚úÖ Phase gewechselt zu:', phaseId);
            } else {
                console.error('‚ùå Phase nicht gefunden:', phaseId);
            }
        }

        function showSuccessToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function updateDashboard() {
            console.log('üìä Aktualisiere Dashboard...');
            
            const nameElement = document.getElementById('dashboardWGName');
            if (nameElement) {
                nameElement.textContent = wgName || 'WG Dashboard';
            }

            const memberCountElement = document.getElementById('memberCount');
            const membersListElement = document.getElementById('membersList');
            
            if (memberCountElement) {
                memberCountElement.textContent = `(${memberProfiles.length})`;
            }
            
            if (membersListElement) {
                if (memberProfiles.length > 0) {
                    membersListElement.innerHTML = memberProfiles.map(member => 
                        `<div class="member-card">
                            <strong>${member.name}</strong>
                            <p style="color: #6b7280; font-size: 14px;">${member.email || 'Keine E-Mail'}</p>
                        </div>`
                    ).join('');
                } else {
                    membersListElement.innerHTML = '<p style="color: #6b7280;">Keine Mitglieder gefunden...</p>';
                }
            }

            const taskCountElement = document.getElementById('taskCount');
            const tasksListElement = document.getElementById('tasksList');
            
            if (taskCountElement) {
                taskCountElement.textContent = `(${tasks.length})`;
            }
            
            if (tasksListElement) {
                if (tasks.length > 0) {
                    tasksListElement.innerHTML = tasks.map((task, index) => {
                        const isCompleted = isTaskCompletedToday(task);
                        return `<div class="interactive-task ${isCompleted ? 'completed' : ''}" onclick="selectTask(${index})">
                            <div class="task-info">
                                <div class="task-emoji">${task.emoji || 'üìã'}</div>
                                <div class="task-details">
                                    <h4>${task.title}</h4>
                                    <p>${task.description || ''}</p>
                                    <small style="color: #3b82f6;">${task.category || 'Allgemein'}</small>
                                </div>
                            </div>
                            <div class="task-actions">
                                ${isCompleted ? 
                                    '<span style="color: #10b981; font-weight: 500;"><i class="fas fa-check"></i> Erledigt</span>' :
                                    `<button class="task-btn task-btn-complete" onclick="event.stopPropagation(); completeTask(${index})">
                                        <i class="fas fa-check"></i> Erledigen
                                    </button>`
                                }
                                <button class="task-btn task-btn-edit" onclick="event.stopPropagation(); editTask(${index})">
                                    <i class="fas fa-edit"></i> Bearbeiten
                                </button>
                            </div>
                        </div>`;
                    }).join('');
                } else {
                    tasksListElement.innerHTML = '<p style="color: #6b7280;">Keine Aufgaben gefunden...</p>';
                }
            }

            // Update Dashboard Statistics
            document.getElementById('totalTasksCount').textContent = tasks.length;
            document.getElementById('completedTasksToday').textContent = taskExecutions.filter(exec => {
                const today = new Date().toDateString();
                return new Date(exec.completedAt).toDateString() === today;
            }).length;
        }

        // === HAUPTFUNKTIONEN ===
        function testFunction() {
            console.log('üß™ Test Function aufgerufen');
            showSuccessToast('‚úÖ Test Function funktioniert!');
            alert('üß™ Test Function arbeitet korrekt!');
        }

        function createNewProfile() {
            console.log('üè† Erstelle neue WG...');
            showSuccessToast('üè† Neue WG wird erstellt...');
            showPhase('phase0');
        }

        function loadWerthiWG() {
            console.log('üöÄ Lade Werthi WG...');
            
            wgName = "Werthi WG";
            memberProfiles = [
                { name: 'Darius', email: 'darius@werthi-wg.com' },
                { name: 'Lilly', email: 'lilly@werthi-wg.com' },
                { name: 'Hendrik I', email: 'hendrik1@werthi-wg.com' },
                { name: 'Hendrik II', email: 'hendrik2@werthi-wg.com' },
                { name: 'Hamza Hamza', email: 'hamza@werthi-wg.com' },
                { name: 'Sofia', email: 'sofia@werthi-wg.com' }
            ];
            
            tasks = [
                { title: 'Kitchen', description: 'K√ºche putzen und aufr√§umen', category: 'K√ºche', emoji: 'üçΩÔ∏è' },
                { title: 'Big bathroom + shower', description: 'Gro√ües Bad und Dusche putzen', category: 'Bad', emoji: 'üõÅ' },
                { title: 'Small bath + livingroom', description: 'Kleines Bad und Wohnzimmer reinigen', category: 'Bad/Wohnzimmer', emoji: 'üöΩ' },
                { title: 'Plastic trash tuesday', description: 'Plastikm√ºll dienstags rausbringen', category: 'M√ºll', emoji: '‚ôªÔ∏è' },
                { title: 'Wg clothes clean + hang', description: 'WG-W√§sche waschen und aufh√§ngen', category: 'W√§sche', emoji: 'üëï' },
                { title: 'Wg clothes put away', description: 'WG-W√§sche wegr√§umen', category: 'W√§sche', emoji: 'üëî' },
                { title: 'Wg shopping', description: 'WG-Einkauf erledigen', category: 'Einkauf', emoji: 'üõí' },
                { title: 'Unclogging shower', description: 'Dusche entstopfen', category: 'Reparatur', emoji: 'üîß' },
                { title: 'Biotrash + clean', description: 'Biom√ºll leeren und s√§ubern', category: 'M√ºll', emoji: 'üå±' },
                { title: 'Restmill + clean', description: 'Restm√ºll leeren und s√§ubern', category: 'M√ºll', emoji: 'üóëÔ∏è' }
            ];

            showSuccessToast('‚úÖ Werthi WG geladen!');
            updateDashboard();
            showPhase('dashboard');
        }

        function nextPhase(phaseNumber) {
            console.log('‚û°Ô∏è N√§chste Phase:', phaseNumber);
            
            if (phaseNumber === 1) {
                const wgNameInput = document.getElementById('wgNameInput');
                if (wgNameInput && wgNameInput.value.trim()) {
                    wgName = wgNameInput.value.trim();
                    showSuccessToast(`‚úÖ WG "${wgName}" erstellt!`);
                    updateDashboard();
                    showPhase('dashboard');
                } else {
                    alert('‚ùå Bitte gib einen WG-Namen ein!');
                }
            }
        }

        function goBack() {
            console.log('‚¨ÖÔ∏è Zur√ºck zu Profile');
            showPhase('profileSelection');
        }

        function goBackToProfiles() {
            console.log('‚¨ÖÔ∏è Zur√ºck zu Profilen');
            showPhase('profileSelection');
        }

        function clearAllProfiles() {
            if (confirm('üóëÔ∏è Alle Profile l√∂schen?')) {
                wgProfiles = {};
                memberProfiles = [];
                tasks = [];
                taskExecutions = [];
                wgName = '';
                showSuccessToast('üóëÔ∏è Alle Profile gel√∂scht!');
                showPhase('profileSelection');
            }
        }

        // === ERWEITERTE TASK-FUNKTIONEN ===
        function isTaskCompletedToday(task) {
            const today = new Date().toDateString();
            return taskExecutions.some(execution => 
                execution.taskTitle === task.title && 
                new Date(execution.completedAt).toDateString() === today
            );
        }

        function updateStatistics() {
            const totalCompleted = taskExecutions.length;
            const totalPoints = taskExecutions.reduce((sum, exec) => sum + (exec.points || 10), 0);
            
            const thisWeek = new Date();
            thisWeek.setDate(thisWeek.getDate() - 7);
            const thisWeekCompleted = taskExecutions.filter(exec => 
                new Date(exec.completedAt) >= thisWeek
            ).length;

            document.getElementById('totalTasksCompleted').textContent = totalCompleted;
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('thisWeekTasks').textContent = thisWeekCompleted;
        }

        function selectTask(taskIndex) {
            const task = tasks[taskIndex];
            showSuccessToast(`üìã ${task.title} ausgew√§hlt`);
        }

        function completeTask(taskIndex) {
            selectedTaskForCompletion = taskIndex;
            const task = tasks[taskIndex];
            
            document.getElementById('completeTaskInfo').innerHTML = `
                <div style="padding: 16px; background: #f0f9ff; border-radius: 8px; margin-bottom: 16px;">
                    <h3 style="margin: 0 0 8px 0; color: #1e40af;">
                        ${task.emoji} ${task.title}
                    </h3>
                    <p style="margin: 0; color: #6b7280;">${task.description}</p>
                </div>
            `;
            
            showModal('completeTaskModal');
        }

        function confirmCompleteTask() {
            if (selectedTaskForCompletion === null) return;
            
            const task = tasks[selectedTaskForCompletion];
            const notes = document.getElementById('taskNotes').value;
            const duration = parseInt(document.getElementById('taskDuration').value);
            
            const execution = {
                id: 'exec_' + Date.now(),
                taskTitle: task.title,
                taskEmoji: task.emoji,
                completedAt: new Date().toISOString(),
                completedBy: memberProfiles[0]?.name || 'Unbekannt', // Erste Person als Standard
                duration: duration,
                notes: notes,
                points: Math.round(10 + (duration - 15) * 0.2) // Punkte basierend auf Zeit
            };
            
            taskExecutions.push(execution);
            
            closeModal('completeTaskModal');
            updateDashboard();
            
            showSuccessToast(`‚úÖ ${task.title} erfolgreich abgeschlossen! +${execution.points} Punkte`);
            
            // Reset form
            document.getElementById('taskNotes').value = '';
            document.getElementById('taskDuration').value = '15';
            selectedTaskForCompletion = null;
        }

        function editTask(taskIndex) {
            showSuccessToast(`‚úèÔ∏è Bearbeitung von "${tasks[taskIndex].title}" - Feature kommt bald!`);
        }

        function addNewTask() {
            showModal('addTaskModal');
        }

        function createNewTask() {
            const title = document.getElementById('newTaskTitle').value.trim();
            const description = document.getElementById('newTaskDescription').value.trim();
            const emoji = document.getElementById('newTaskEmoji').value.trim();
            const category = document.getElementById('newTaskCategory').value;
            
            if (!title) {
                alert('‚ùå Bitte gib einen Task-Namen ein!');
                return;
            }
            
            const newTask = {
                title: title,
                description: description || 'Keine Beschreibung',
                emoji: emoji || 'üìã',
                category: category
            };
            
            tasks.push(newTask);
            
            closeModal('addTaskModal');
            updateDashboard();
            
            showSuccessToast(`‚úÖ "${title}" wurde hinzugef√ºgt!`);
            
            // Reset form
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDescription').value = '';
            document.getElementById('newTaskEmoji').value = '';
            document.getElementById('newTaskCategory').value = 'K√ºche';
        }

        function showTaskAssignments() {
            showSuccessToast('üìÖ Task-Zuteilungen - Feature kommt bald!');
        }

        function showSettings() {
            showSuccessToast('‚öôÔ∏è WG Einstellungen - Feature kommt bald!');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // === DASHBOARD NAVIGATION FUNKTIONEN ===
        function showTaskTable() {
            console.log('üîÑ Navigiere zu Task-Tabelle');
            showPhase('taskTable');
            buildTaskTable();
        }

        function showTaskManagement() {
            console.log('üîÑ Navigiere zu Task-Management');
            showPhase('taskManagement');
            buildTaskManagementList();
        }

        function showSetupSummary() {
            console.log('üîÑ Navigiere zu Setup-√úbersicht');
            showPhase('setupSummary');
            buildSetupSummary();
        }

        function showAbsenceManager() {
            console.log('üîÑ Navigiere zu Abwesenheits-Manager');
            showPhase('absenceManager');
            buildAbsenceManager();
        }

        // === TASK TABLE FUNKTIONEN ===
        function buildTaskTable() {
            const table = document.getElementById('taskTableGrid');
            if (!table) return;

            // Header erstellen
            let html = '<thead><tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">';
            html += '<th style="padding: 12px; text-align: left; border: none;">Task</th>';
            
            memberProfiles.forEach(member => {
                html += `<th style="padding: 12px; text-align: center; border: none; font-size: 14px;">${member.name}</th>`;
            });
            html += '</tr></thead><tbody>';

            // Task Rows erstellen
            tasks.forEach((task, taskIndex) => {
                html += `<tr style="border-bottom: 1px solid #e5e7eb;">`;
                html += `<td style="padding: 12px; font-weight: 600;">
                    <span style="margin-right: 8px;">${task.emoji}</span>
                    <span onclick="completeTaskFromTable('${task.title}')" style="cursor: pointer; color: #3b82f6; text-decoration: underline;">
                        ${task.title}
                    </span>
                </td>`;
                
                memberProfiles.forEach(member => {
                    const executions = taskExecutions.filter(exec => 
                        exec.taskTitle === task.title && exec.completedBy === member.name
                    );
                    
                    html += `<td style="padding: 12px; text-align: center;">`;
                    if (executions.length > 0) {
                        const latest = executions[executions.length - 1];
                        const date = new Date(latest.completedAt);
                        html += `<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                            ${date.getDate()}.${date.getMonth() + 1}
                        </span>`;
                    } else {
                        html += '<span style="color: #9ca3af;">-</span>';
                    }
                    html += '</td>';
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function completeTaskFromTable(taskTitle) {
            const task = tasks.find(t => t.title === taskTitle);
            if (!task) return;
            
            const member = memberProfiles[0]; // Erste Person als Standard
            const execution = {
                id: 'exec_' + Date.now(),
                taskTitle: task.title,
                taskEmoji: task.emoji,
                completedAt: new Date().toISOString(),
                completedBy: member.name,
                duration: 15,
                notes: 'Von Tabelle erledigt',
                points: 10
            };
            
            taskExecutions.push(execution);
            buildTaskTable();
            showSuccessToast(`‚úÖ ${task.title} erledigt!`);
        }

        function addRandomTaskExecution() {
            if (tasks.length === 0 || memberProfiles.length === 0) {
                showErrorToast('‚ùå Keine Tasks oder Mitglieder verf√ºgbar');
                return;
            }
            
            const randomTask = tasks[Math.floor(Math.random() * tasks.length)];
            const randomMember = memberProfiles[Math.floor(Math.random() * memberProfiles.length)];
            
            const execution = {
                id: 'exec_' + Date.now(),
                taskTitle: randomTask.title,
                taskEmoji: randomTask.emoji,
                completedAt: new Date().toISOString(),
                completedBy: randomMember.name,
                duration: Math.floor(Math.random() * 30) + 10,
                notes: 'Zuf√§llige Ausf√ºhrung',
                points: Math.floor(Math.random() * 20) + 5
            };
            
            taskExecutions.push(execution);
            buildTaskTable();
            showSuccessToast(`üéØ ${randomTask.title} zuf√§llig von ${randomMember.name} erledigt!`);
        }

        // === TASK MANAGEMENT FUNKTIONEN ===
        function buildTaskManagementList() {
            const container = document.getElementById('taskManagementList');
            if (!container) return;

            let html = '';
            tasks.forEach((task, index) => {
                html += `
                <div style="padding: 16px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <span style="font-size: 24px;">${task.emoji}</span>
                        <input type="text" value="${task.title}" 
                               id="taskTitle_${index}"
                               style="flex: 1; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-weight: 600;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 4px;">Beschreibung:</label>
                        <textarea id="taskDesc_${index}" 
                                  style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;"
                                  rows="2">${task.description || ''}</textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 4px;">Kategorie:</label>
                            <select id="taskCategory_${index}" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="K√ºche" ${task.category === 'K√ºche' ? 'selected' : ''}>K√ºche</option>
                                <option value="Bad" ${task.category === 'Bad' ? 'selected' : ''}>Bad</option>
                                <option value="Wohnbereich" ${task.category === 'Wohnbereich' ? 'selected' : ''}>Wohnbereich</option>
                                <option value="Sonstiges" ${task.category === 'Sonstiges' ? 'selected' : ''}>Sonstiges</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 4px;">Emoji:</label>
                            <input type="text" value="${task.emoji}" 
                                   id="taskEmoji_${index}"
                                   style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;"
                                   maxlength="2">
                        </div>
                    </div>
                </div>`;
            });
            
            container.innerHTML = html;
        }

        function saveTaskChanges() {
            tasks.forEach((task, index) => {
                const titleInput = document.getElementById(`taskTitle_${index}`);
                const descInput = document.getElementById(`taskDesc_${index}`);
                const categoryInput = document.getElementById(`taskCategory_${index}`);
                const emojiInput = document.getElementById(`taskEmoji_${index}`);
                
                if (titleInput) task.title = titleInput.value;
                if (descInput) task.description = descInput.value;
                if (categoryInput) task.category = categoryInput.value;
                if (emojiInput) task.emoji = emojiInput.value;
            });
            
            showSuccessToast('üíæ Task-√Ñnderungen gespeichert!');
            buildTaskManagementList();
        }

        // === SETUP SUMMARY FUNKTIONEN ===
        function buildSetupSummary() {
            // Mitglieder anzeigen
            const membersContainer = document.getElementById('setupMembersList');
            if (membersContainer) {
                let html = memberProfiles.map(member => `
                    <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px;">
                        <strong>${member.name}</strong>
                        <p style="color: #6b7280; margin: 4px 0 0 0;">${member.email || 'Keine E-Mail'}</p>
                    </div>
                `).join('');
                membersContainer.innerHTML = html || '<p style="color: #6b7280;">Keine Mitglieder</p>';
            }

            // Tasks anzeigen
            const tasksContainer = document.getElementById('setupTasksList');
            if (tasksContainer) {
                let html = tasks.map(task => `
                    <div style="display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                        <span style="font-size: 20px; margin-right: 12px;">${task.emoji}</span>
                        <div>
                            <strong>${task.title}</strong>
                            <p style="color: #6b7280; margin: 0;">${task.category || 'Allgemein'} - ${task.description || 'Keine Beschreibung'}</p>
                        </div>
                    </div>
                `).join('');
                tasksContainer.innerHTML = html || '<p style="color: #6b7280;">Keine Tasks</p>';
            }

            // Statistiken anzeigen
            const statsContainer = document.getElementById('setupStatistics');
            if (statsContainer) {
                const totalExecutions = taskExecutions.length;
                const totalPoints = taskExecutions.reduce((sum, exec) => sum + (exec.points || 0), 0);
                const thisWeek = taskExecutions.filter(exec => {
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return new Date(exec.completedAt) >= weekAgo;
                }).length;

                statsContainer.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                        <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${totalExecutions}</div>
                            <div style="font-size: 12px; color: #6b7280;">Tasks erledigt</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: #eff6ff; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">${totalPoints}</div>
                            <div style="font-size: 12px; color: #6b7280;">Punkte gesamt</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: #fefce8; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${thisWeek}</div>
                            <div style="font-size: 12px; color: #6b7280;">Diese Woche</div>
                        </div>
                    </div>
                `;
            }
        }

        // === ABSENCE MANAGER FUNKTIONEN ===
        function buildAbsenceManager() {
            // User Grid f√ºr Auswahl erstellen
            const userGrid = document.getElementById('absenceUserGrid');
            if (userGrid) {
                let html = memberProfiles.map(member => `
                    <div onclick="selectUserForAbsence('${member.name}')" 
                         style="padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;"
                         onmouseover="this.style.borderColor='#3b82f6'; this.style.background='#eff6ff'"
                         onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                        <div style="font-size: 20px; margin-bottom: 8px;">üë§</div>
                        <strong>${member.name}</strong>
                    </div>
                `).join('');
                userGrid.innerHTML = html || '<p style="color: #6b7280;">Keine Mitglieder</p>';
                userGrid.style.display = 'grid';
                userGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(120px, 1fr))';
                userGrid.style.gap = '12px';
            }

            // Abwesenheitsliste anzeigen
            updateAbsenceList();
        }

        let selectedAbsenceUser = null;

        function selectUserForAbsence(userName) {
            selectedAbsenceUser = userName;
            showSuccessToast(`üë§ ${userName} ausgew√§hlt`);
            
            // Zeige Datum-Auswahl
            document.getElementById('absenceUserSelection').style.display = 'block';
            document.getElementById('absenceDateSelection').classList.remove('hidden');
            
            // Setze heutiges Datum als Standard
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('absenceStartDate').value = today;
            document.getElementById('absenceEndDate').value = today;
        }

        function cancelAbsenceEntry() {
            selectedAbsenceUser = null;
            document.getElementById('absenceDateSelection').classList.add('hidden');
        }

        function saveAbsence() {
            if (!selectedAbsenceUser) {
                showErrorToast('‚ùå Bitte w√§hle einen Benutzer aus');
                return;
            }

            const reason = document.getElementById('absenceReason').value;
            const startDate = document.getElementById('absenceStartDate').value;
            const endDate = document.getElementById('absenceEndDate').value;

            if (!startDate || !endDate) {
                showErrorToast('‚ùå Bitte w√§hle Start- und Enddatum');
                return;
            }

            // Speichere Abwesenheit
            if (!window.absences) window.absences = [];
            
            const absence = {
                id: 'absence_' + Date.now(),
                user: selectedAbsenceUser,
                reason: reason,
                startDate: startDate,
                endDate: endDate,
                createdAt: new Date().toISOString()
            };
            
            window.absences.push(absence);
            
            showSuccessToast(`‚úÖ Abwesenheit f√ºr ${selectedAbsenceUser} gespeichert!`);
            
            // Reset form
            cancelAbsenceEntry();
            updateAbsenceList();
        }

        function updateAbsenceList() {
            const container = document.getElementById('absenceList');
            if (!container) return;

            if (!window.absences || window.absences.length === 0) {
                container.innerHTML = '<p style="color: #6b7280;">Keine Abwesenheiten eingetragen</p>';
                return;
            }

            const reasonEmojis = {
                vacation: 'üèñÔ∏è',
                sick: 'ü§í',
                work: 'üíº',
                family: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                other: '‚ùì'
            };

            let html = window.absences.map(absence => `
                <div style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${reasonEmojis[absence.reason] || '‚ùì'} ${absence.user}</strong>
                            <p style="color: #6b7280; margin: 4px 0 0 0;">
                                ${new Date(absence.startDate).toLocaleDateString()} - ${new Date(absence.endDate).toLocaleDateString()}
                            </p>
                        </div>
                        <button onclick="deleteAbsence('${absence.id}')" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function deleteAbsence(absenceId) {
            if (!window.absences) return;
            
            window.absences = window.absences.filter(absence => absence.id !== absenceId);
            updateAbsenceList();
            showSuccessToast('üóëÔ∏è Abwesenheit gel√∂scht');
        }

        function addDemoAbsences() {
            if (!window.absences) window.absences = [];
            
            const demoAbsences = [
                {
                    id: 'demo1_' + Date.now(),
                    user: memberProfiles[0]?.name || 'Demo User',
                    reason: 'vacation',
                    startDate: '2025-10-01',
                    endDate: '2025-10-07',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo2_' + Date.now() + 1,
                    user: memberProfiles[1]?.name || 'Demo User 2',
                    reason: 'work',
                    startDate: '2025-09-25',
                    endDate: '2025-09-27',
                    createdAt: new Date().toISOString()
                }
            ];
            
            window.absences.push(...demoAbsences);
            updateAbsenceList();
            showSuccessToast('üéØ Demo-Abwesenheiten hinzugef√ºgt!');
        }

        // === WINDOW EXPORT ===
        window.testFunction = testFunction;
        window.createNewProfile = createNewProfile;
        window.loadWerthiWG = loadWerthiWG;
        window.nextPhase = nextPhase;
        window.goBack = goBack;
        window.goBackToProfiles = goBackToProfiles;
        window.clearAllProfiles = clearAllProfiles;
        window.showPhase = showPhase;
        
        // Task Management Funktionen
        window.selectTask = selectTask;
        window.completeTask = completeTask;
        window.confirmCompleteTask = confirmCompleteTask;
        window.editTask = editTask;
        window.addNewTask = addNewTask;
        window.createNewTask = createNewTask;
        window.showTaskAssignments = showTaskAssignments;
        window.showSettings = showSettings;
        window.showModal = showModal;
        window.closeModal = closeModal;
        
        // Dashboard Navigation Funktionen
        window.showTaskTable = showTaskTable;
        window.showTaskManagement = showTaskManagement;
        window.showSetupSummary = showSetupSummary;
        window.showAbsenceManager = showAbsenceManager;

        // === INITIALISIERUNG ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM geladen');
            showSuccessToast('üöÄ App erfolgreich geladen!');
        });

        console.log('‚úÖ Reparierte App geladen - Alle Funktionen exportiert');
        console.log('üåê Verf√ºgbare Funktionen:', {
            testFunction: typeof window.testFunction,
            createNewProfile: typeof window.createNewProfile,
            loadWerthiWG: typeof window.loadWerthiWG,
            nextPhase: typeof window.nextPhase
        });
    </script>
</body>
</html>